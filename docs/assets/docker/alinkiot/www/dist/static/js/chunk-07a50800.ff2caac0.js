(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-07a50800","chunk-3417166a","chunk-1ac012ea","chunk-5f53121e","chunk-1d8a1656","chunk-4d2869f2","chunk-f3d6cca6","chunk-02f71bbf"],{"01f2":function(e,t,a){},1866:function(e,t,a){"use strict";a("01f2")},"22fc":function(e,t,a){},"3ea5":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{attrs:{id:"video-container"}}),a("el-row",{staticClass:"thingBox",style:e.style},e._l(e.things,(function(t){return a("el-col",{key:t.name,attrs:{span:12,id:"box_"+t.name}},[a("div",{staticClass:"thing_name"},[a("div",{staticClass:"thing_value",attrs:{id:t.name}},[e._v("--")])]),"alarmType"===t.name?a("div",{staticClass:"update_time",attrs:{id:"update_"+t.name}}):e._e()])})),1)],1)},n=[],s=(a("b64b"),a("4de4"),a("d3b7"),a("b0c0"),a("d81d"),a("c38d")),o=a.n(s),c=a("5a98"),r=a("a6e8"),l=a("5a0c"),d=a.n(l),u={components:{},props:{device:{type:Object},data:{type:Object},env:{type:Object,default:function(){return{}}}},data:function(){return{things:[],width:600,height:400,style:""}},mounted:function(){var e=this,t={addr:this.device.addr};Object(c["c"])(t).then((function(t){var a=t.data;a.config=JSON.parse(a.config),e.createEZPlayer("video-container",e.width,e.height,a)}))},created:function(){this.things=this.device.product.thing,this.env.width&&(this.width=this.env.width,this.height=4*this.env.width/6),this.style="width: "+this.width+"px;"},methods:{createEZPlayer:function(e,t,a,i){var n=i.config.filter((function(e){return"device_serial"===e.name}));new o.a.EZUIKitPlayer({id:e,accessToken:i.accessToken,url:"ezopen://open.ys7.com/"+n[0].value+"/1.hd.live",template:"security",audio:0,width:t,height:a})},formatTitle:function(e,t){if("alarmType"!==e){if("pictureList"===e){var a=JSON.parse(t),i="";return a.map((function(e){i+='<img style="width: 100%; padding:5px;" src="'+e+'"/>'})),i}return t}switch(t){case"motiondetect":return'<i class="el-icon-message-solid"></i>移动侦测';default:return t}},reload:function(){var e=this;this.things.map((function(t){var a=Object(r["d"])(e.data,t.name,"--"),i=document.getElementById(t.name);(a.value||0===a.value)&&(i.innerHTML=e.formatTitle(t.name,a.value));var n=document.getElementById("update_"+t.name);n&&(n.innerText=d()(1e3*a.ts).format("YYYY-MM-DD HH:mm:ss"))}))}},watch:{device:function(){this.things=this.device.product.thing},data:function(){this.reload()}}},p=u,v=(a("e64e"),a("2877")),h=Object(v["a"])(p,i,n,!1,null,"89896212",null);t["default"]=h.exports},"44fb":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-col",[a("el-row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:10}},[a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["system:sub_device:add"],expression:"['system:sub_device:add']"}],attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:e.handleSubAdd}},[e._v("绑定")])],1),a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["system:sub_device:remove"],expression:"['system:sub_device:remove']"}],attrs:{type:"danger",icon:"el-icon-delete",size:"mini",disabled:e.multiple},on:{click:e.handleSubDelete}},[e._v("解绑")])],1)],1),a("DeviceTable",{attrs:{queryParams:e.queryParams,columns:e.columns,buttons:e.buttons,refresh:e.refresh},on:{handleEvent:e.handleEvent,handleSelectionChange:e.handleSelectionChange}})],1)],1),a("el-dialog",{attrs:{title:"添加子设备",visible:e.openSubSelector,width:"550px"},on:{"update:visible":function(t){e.openSubSelector=t}}},[a("el-form",{ref:"subForm",attrs:{model:e.subDevice,rules:e.subRules,inline:!0,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"从站地址(0x)",prop:"subAddr"}},[a("el-input",{attrs:{placeholder:"请输入从站地址"},model:{value:e.subDevice.subAddr,callback:function(t){e.$set(e.subDevice,"subAddr",t)},expression:"subDevice.subAddr"}})],1),a("InputTableSelect",{attrs:{showColumn:"name",label:"设备名称",table:"device",prop:"subDev"},on:{selectDone:e.selectDeviceDone}})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.addDeviceDone}},[e._v("确定")])],1)],1),a("el-dialog",{attrs:{title:"配置子设备",visible:e.openSetSelector,width:"550px"},on:{"update:visible":function(t){e.openSetSelector=t}}},[a("el-form",{ref:"subForm",attrs:{model:e.subDevice,rules:e.subRules,inline:!0,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"波特率",prop:"baud"}},[a("el-select",{attrs:{placeholder:"请选择波特率"},model:{value:e.baud,callback:function(t){e.baud=t},expression:"baud"}},e._l(e.bauds,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){}}},[e._v("确定")])],1)],1)],1)},n=[],s=(a("a15b"),a("d81d"),a("5a98")),o=a("84de"),c=a("91e5"),r={inject:["reload"],components:{DeviceTable:c["default"],InputTableSelect:o["a"]},props:{device:{type:Object,default:function(){}},product:{type:Object,default:function(){}}},data:function(){var e=function(e,t,a){var i=e.fullField,n=e.self,s=function(){return!(n.subDevice&&n.subDevice.addr)};s()?a(new Error(i.message)):a()};return{loading:!1,baud:9600,bauds:[2400,4800,9600,19200,38400,115200],tableList:[],ids:[],total:0,queryParams:{pageNum:1,pageSize:10},refresh:!1,buttons:[{text:"详情",event:"goEdit",icon:"el-icon-info",permission:"['system:device:edit']"}],columns:[{key:"name",label:"设备名称",visible:!0},{key:"addr",label:"设备地址",visible:!0},{key:"product",label:"所属产品",visible:!0},{key:"project",label:"所属项目",visible:!0},{key:"online",label:"在线状态",visible:!0},{key:"status",label:"是否启用",visible:!0},{key:"netType",label:"协议类型",visible:!0}],single:!0,multiple:!0,openSubSelector:!1,openSetSelector:!1,subDevice:{addr:void 0,subAddr:void 0},subRules:{subAddr:[{required:!0,message:"从站地址不能为空",trigger:"blur"}],subDev:[{self:this,validator:e,required:!0,message:"子设备不能为空",trigger:"blur"}]}}},created:function(){this.queryParams.gateway=this.device.addr,this.queryParams["orderBy[asc]"]="subAddr"},methods:{handleSubAdd:function(){this.openSubSelector=!0,this.subDevice={addr:void 0,subAddr:void 0}},handleSubDelete:function(){var e=this;Object(s["b"])("sub_device",this.ids.join(",")).then((function(t){e.$modal.msgSuccess("解绑成功"),e.refresh=!e.refresh}))},handleEvent:function(e,t){if("goEdit"===e){var a="/device/deviceEdit?id="+this.$route.query.id,i="/device/deviceEdit",n=this.$route.params.project;n&&(i="/"+n+i,a="/"+n+a),this.$router.push({path:i,query:{id:t.id,redirect:a}}),this.reload()}else"setting"===e&&(console.log(t),this.openSetSelector=!0)},handleSelectionChange:function(e){var t=e.selection;this.ids=t.map((function(e){return e.subDevId})),this.single=1!==t.length,this.multiple=!t.length,this.tableList=e.tableList},addDeviceDone:function(){var e=this;this.$refs["subForm"].validate((function(t){if(t){var a={gateway:e.device.addr,subAddr:e.subDevice.subAddr};Object(s["k"])("sub_device",a).then((function(t){var a=t.data.length;a>0?e.$modal.msgWarning("从站地址已经存在！"):Object(s["a"])("sub_device",e.subDevice).then((function(t){e.openSubSelector=!1,e.refresh=!e.refresh,e.$modal.msgSuccess("新增成功")}))}))}}))},selectDeviceDone:function(e){this.subDevice.subAddr&&(this.subDevice.gateway=this.device.addr,this.subDevice.addr=e.addr)}}},l=r,d=a("2877"),u=Object(d["a"])(l,i,n,!1,null,"667d6e0e",null);t["default"]=u.exports},"4b47":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("TableShow",{attrs:{columns:e.columns,item:e.device},on:{selectMapDone:e.selectMapDone}}),e.device.lng&&e.device.lat?a("div",{staticClass:"amap-wrapper",style:{height:e.height+"px"}},[a("el-amap",{attrs:{vid:"amapScene","amap-manager":e.amapManager,zoom:e.zoom,center:e.center,events:e.events,"map-style":e.styleName,plugin:e.plugins}},[a("el-amap-marker",{attrs:{position:e.center,events:e.events}}),a("el-amap-info-window",{attrs:{position:e.center,content:e.device.location,offset:[0,-35]}})],1)],1):e._e()],1)},n=[],s=(a("a9e3"),a("ac1f"),a("00b4"),a("8f9b")),o=a("870c"),c=a("34cf"),r=a("5a98"),l=new s["AMapManager"],d={components:{TableShow:c["a"]},props:{device:{type:Object,required:!0},height:{type:Number,default:function(){return 500}}},computed:{styleName:function(){var e=this.$store.state.settings.sideTheme;return/theme-dark-.+/.test(e)?"amap://styles/blue":"amap://styles/normal"}},data:function(){var e=this;return{amapManager:l,plugins:["ToolBar","Autocomplete","OverView","Geocoder"],zoom:13,center:[121.59996,31.197646],columns:[{key:"country",title:"国家",type:"text"},{key:"district",title:"区域",type:"text"},{key:"lat",title:"经纬度",type:"relation",on:"lng"},{key:"location",title:"位置",type:"map",lat:"lat",lng:"lng"}],events:{complete:function(t){e.device.lng&&e.device.lat&&(e.center=[e.device.lng,e.device.lat])}}}},created:function(){Object(o["e"])(this)},methods:{selectMapDone:function(e,t){var a=this,i={id:this.device.id,location:t.location,country:t.country,province:t.province,district:t.district,lat:t.lat,lng:t.lng};Object(r["l"])("device",i).then((function(e){a.device.location=t.location,a.device.country=t.country,a.device.province=t.province,a.device.district=t.district,a.device.lat=t.lat,a.device.lng=t.lng,a.$modal.msgSuccess("修改成功!")}))}}},u=d,p=(a("fa36"),a("2877")),v=Object(p["a"])(u,i,n,!1,null,"74ed1f57",null);t["default"]=v.exports},"4d91":function(e,t,a){"use strict";a("b064")},6137:function(e,t,a){},"662e":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[[a("div",{staticClass:"title-dev"},[e.device?a("span",[e._v(e._s(e.device.name))]):e._e()]),a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"设备详情",name:"baseInfo"}},[a("BaseInfo",{attrs:{id:e.deviceId},on:{onload:e.onDeviceLoad}})],1),e.device&&e.product&&"gateway"===e.product.nodeType?a("el-tab-pane",{attrs:{label:"子设备",name:"childrenPane"}},[a("ChildrenBoard",{attrs:{device:e.device,product:e.product}})],1):e._e(),e.device&&e.product&&"children"===e.product.nodeType?a("el-tab-pane",{attrs:{label:"网关",name:"gatewayPane"}},[a("GatewayBoard",{attrs:{device:e.device}})],1):e._e(),e.device?a("el-tab-pane",{attrs:{label:"设备鉴权",name:"topicTab"}},[a("TopicBoard",{attrs:{device:e.device,product:e.product}})],1):e._e(),e.device?a("el-tab-pane",{attrs:{label:"设备地图",name:"mapTab"}},[a("MapBoard",{attrs:{device:e.device}})],1):e._e(),e.product&&e.product.thing&&"[]"!==e.product.thing?a("el-tab-pane",{attrs:{label:"实时数据",name:"devStatusPane"}},[a("DeviceBoard",{attrs:{devId:e.deviceId}})],1):e._e()],1)]],2)},n=[],s=a("e412"),o=a("7a56"),c=a("84de"),r=a("452d"),l=a("ca07"),d=a("44fb"),u=a("8f18"),p=a("4b47"),v={name:"DeviceInfo",inject:["reload"],dicts:[],components:{BaseInfo:u["default"],GatewayBoard:l["default"],InputTableSelect:c["a"],DeviceBoard:o["default"],TopicBoard:s["default"],ExtendEditor:r["default"],ChildrenBoard:d["default"],MapBoard:p["default"]},data:function(){return{deviceId:void 0,product:void 0,device:void 0,activeName:"baseInfo"}},created:function(){this.deviceId=this.$route.query.id},methods:{onDeviceLoad:function(e){this.device=e.device,this.product=e.product}}},h=v,f=(a("4d91"),a("2877")),b=Object(f["a"])(h,i,n,!1,null,"573d630a",null);t["default"]=b.exports},"7a56":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("MqttBoard",{attrs:{subscription:e.subscription,publish:e.publish},on:{doMqttMessage:e.doMqttMessage}}),a("DevicePannel",{attrs:{recvData:e.recvData,devId:e.devId,env:e.env,protocol:e.protocol},on:{onload:e.onLoad,send:e.doSend}})],1)},n=[],s=(a("a9e3"),a("e9c4"),a("b64b"),a("fb77")),o=a("d4c0"),c={components:{MqttBoard:s["a"],DevicePannel:o["default"]},props:{devId:{type:[String,Number]},env:{type:Object,default:function(){return{}}}},data:function(){return{device:void 0,product:void 0,subscription:{},publish:{},recvData:void 0,protocol:""}},created:function(){},methods:{doSend:function(e,t){var a={msgType:"control_device",data:{type:"write",addr:this.device.addr,name:e,value:t}};this.publish={topic:"p/in",qos:0,payload:JSON.stringify(a)},this.$modal.msgSuccess("发送成功!")},onLoad:function(e){console.log("this.device",e),this.device=e,this.$emit("deviceChange",this.device),this.product=e.product,this.protocol=this.product.protocol,this.subscription={topic:"p/out/"+e.addr,qos:0}},doMqttMessage:function(e,t){var a=JSON.parse(t);this.recvData=a}}},r=c,l=a("2877"),d=Object(l["a"])(r,i,n,!1,null,"09ef4578",null);t["default"]=d.exports},8050:function(e,t,a){"use strict";a("6137")},"8be5":function(e,t,a){"use strict";a("22fc")},"91e5":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.queryParams?a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e.tableList.length>0?a("div",["card"===e.showType?a("el-row",{attrs:{gutter:10}},e._l(e.tableList,(function(t){return a("el-col",{key:t.addr,staticStyle:{"margin-bottom":"10px"},attrs:{xs:e.size[0],sm:e.size[1],md:e.size[2],lg:e.size[3],xl:e.size[4]}},[a("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[a("el-checkbox",{on:{change:function(a){return e.handleCardSelectionChange(a,t)}}}),a("el-button",{staticClass:"card-title",attrs:{type:"text"}},[e._v(e._s(t.name))])],1),a("div",{staticStyle:{float:"right"}},[e.isShow("netType")?a("dict-tag",{attrs:{options:e.dict.type.iot_net_type,value:t.product.netType}}):e._e()],1)]),a("el-container",[a("el-main",{staticStyle:{padding:"0px"}},[a("div",{staticClass:"card-row"},[e.isShow("nodeType")?a("dict-tag",{attrs:{options:e.dict.type.iot_node_type,value:t.product.nodeType}}):e._e(),"ezviz"!==t.product.category?a("span",[t.lastOnline?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"上线时间："+e.parseTime(t.lastOnline),placement:"bottom"}},[a("dict-tag",{attrs:{options:e.dict.type.iot_device_status,value:t.online}})],1):a("dict-tag",{attrs:{options:e.dict.type.iot_device_status,value:t.online}})],1):e._e(),e.isShow("status")&&"1"===t.status?a("el-tag",{attrs:{type:"danger"}},[e._v("禁用")]):e._e()],1),e.isShow("subAddr")?a("div",{staticClass:"card-row"},[a("span",{staticClass:"card-row-header"},[e._v("从站地址: ")]),e._v(e._s(t.subAddr)+" ")]):e._e(),a("div",{staticClass:"card-row"},[a("span",{staticClass:"card-row-header"},[e._v("设备地址: ")]),e._v(e._s(t.addr)+" ")]),e.isShow("project")?a("div",{staticClass:"card-row"},[a("span",{staticClass:"card-row-header"},[e._v("所属项目: ")]),e._v(e._s(e.formatRow(t,{property:"project"}))+" ")]):e._e(),e.isShow("product")?a("div",{staticClass:"card-row"},[a("span",{staticClass:"card-row-header"},[e._v("所属产品: ")]),e._v(e._s(t.product.name)+" ")]):e._e(),e.isShow("createTime")?a("div",{staticClass:"card-row"},[a("span",{staticClass:"card-row-header"},[e._v("创建时间: ")]),e._v(e._s(e.parseTime(t.createTime))+" ")]):e._e()]),a("el-aside",{staticStyle:{width:"80px","background-color":"unset",padding:"0px"}},[t.product&&t.product.img?a("ImagePreview",{attrs:{src:t.product.img}}):e._e()],1)],1),a("div",e._l(e.buttons,(function(i){return a("el-button",{key:i.event,attrs:{type:"text",icon:i.icon,"v-hasPermi":i.permission},on:{click:function(a){return e.handleClick(i.event,t)}}},[e._v(e._s(i.text))])})),1)],1)],1)})),1):a("el-table",{attrs:{data:e.tableList},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),e.isShow("subAddr")?a("el-table-column",{key:"subAddr",attrs:{label:"从站地址",prop:"subAddr",align:"center"}}):e._e(),a("el-table-column",{key:"name",attrs:{label:"设备名称",prop:"name",align:"center"}}),a("el-table-column",{key:"addr",attrs:{label:"设备地址",prop:"addr",align:"center"}}),e.isShow("netType")?a("el-table-column",{attrs:{label:"连网类型",align:"center",prop:"netType"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("dict-tag",{attrs:{options:e.dict.type.iot_net_type,value:t.row.product.netType}})]}}],null,!1,3527849428)}):e._e(),e.isShow("project")?a("el-table-column",{attrs:{label:"所属项目",align:"center",prop:"project",formatter:e.formatRow}}):e._e(),e.isShow("product")?a("el-table-column",{attrs:{label:"所属产品",align:"center",prop:"product"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.product.name))]}}],null,!1,1879660959)}):e._e(),e.isShow("nodeType")?a("el-table-column",{attrs:{label:"设备类型",align:"center",prop:"nodeType"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("dict-tag",{attrs:{options:e.dict.type.iot_node_type,value:t.row.product.nodeType}})]}}],null,!1,3699797204)}):e._e(),e.isShow("status")?a("el-table-column",{attrs:{label:"是否启用",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":"0","inactive-value":"1"},on:{change:function(a){return e.handleStatusChange(t.row)}},model:{value:t.row.status,callback:function(a){e.$set(t.row,"status",a)},expression:"scope.row.status"}})]}}],null,!1,3955094654)}):e._e(),e.isShow("online")?a("el-table-column",{key:"online",attrs:{label:"在线状态",prop:"online",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["ezviz"===t.row.product.category?a("div",[e._v("-")]):a("div",[t.row.lastOnline?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"上线时间："+e.parseTime(t.row.lastOnline),placement:"bottom"}},[a("dict-tag",{attrs:{options:e.dict.type.iot_device_status,value:t.row.online}})],1):a("dict-tag",{attrs:{options:e.dict.type.iot_device_status,value:t.row.online}})],1)]}}],null,!1,3260477523)}):e._e(),e.isShow("createTime")?a("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}],null,!1,3078210614)}):e._e(),e.buttons.length>0?a("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(e.buttons,(function(i){return a("el-button",{key:i.event,attrs:{type:"text",icon:i.icon,"v-hasPermi":i.permission},on:{click:function(a){return e.handleClick(i.event,t.row)}}},[e._v(e._s(i.text))])}))}}],null,!1,49746620)}):e._e()],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],staticStyle:{"margin-bottom":"25px"},attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1):a("el-empty",{attrs:{description:"暂无设备"}})],1):e._e()},n=[],s=(a("4de4"),a("d3b7"),a("b64b"),a("e9c4"),a("caad"),a("2532"),a("d81d"),a("a15b"),a("5a98")),o={dicts:["sys_normal_disable","iot_node_type","iot_device_status","iot_net_type"],components:{},props:{showType:{type:String,default:"card"},columns:{type:Array,default:function(){return[{key:"product",label:"所属产品",visible:!0},{key:"project",label:"所属项目",visible:!0},{key:"nodeType",label:"设备类型",visible:!0},{key:"netType",label:"协议类型",visible:!0},{key:"online",label:"在线状态",visible:!0},{key:"status",label:"是否启用",visible:!0},{key:"createTime",label:"创建时间",visible:!0}]}},refresh:{type:Boolean,default:!1},buttons:{type:Array,default:function(){return[]}},queryParams:{type:Object,default:function(){}},size:{type:Array,default:function(){return[24,12,8,8,6]}}},data:function(){return{loading:!1,table:"device",projects:[],total:0,tableList:[],selection:[]}},created:function(){this.getList()},methods:{isShow:function(e){var t=this.columns.filter((function(t){return t.key===e}));return t.length>0&&t[0].visible},getList:function(){if(this.queryParams){this.loading=!0;var e=this,t=JSON.parse(JSON.stringify(this.queryParams));t.pageNum=t.pageNum?t.pageNum:1,t.pageSize=t.pageSize?t.pageSize:10,t.gateway?(this.columns.includes("subAddr")||this.columns.push({key:"subAddr",label:"从站地址",visible:!0}),Object(s["d"])(t).then((function(t){var a=t.rows;e.formatTableList(e,t.total,a)}))):t.scene?Object(s["i"])(t).then((function(t){var a=t.rows;e.formatTableList(e,t.total,a)})):Object(s["k"])(this.table,t).then((function(t){var a=t.rows;e.formatTableList(e,t.total,a)}))}else this.tableList=[]},formatTableList:function(e,t,a){e.updateTableList(a,(function(i,n){a.map((function(e){var t=i.filter((function(t){return t.addr===e.addr})),a=n.filter((function(t){return t.id===e.product}));t&&t.length>0&&1===t[0].online?(e.online=1,e.lastOnline=t[0].connectTime):e.online=0,e.product=a&&a.length>0?a[0]:{}})),e.total=t,e.tableList=a,e.loading=!1}))},queryRelation:function(e,t,a){var i=[];t.length>0?Object(s["g"])(e,t.join(",")).then((function(e){var t=e.data;Array.isArray(t)?i=t:i.push(t),a(i)})).catch((function(e){a([])})):a(i)},updateTableList:function(e,t){var a=this,i=[],n=[],o=[];e.map((function(e){n.push(e.addr),e.product&&!i.includes(e.product)&&i.push(e.product),e.project&&!o.includes(e.project)&&o.push(e.project)})),Object(s["j"])(n.join(",")).then((function(e){var n=e.data;a.queryRelation("product",i,(function(e){a.queryRelation("project",o,(function(i){a.projects=i,t(n,e)}))}))}))},handleCardSelectionChange:function(e,t){e?this.selection.push(t):this.selection=this.selection.filter((function(e){return e.id!==t.id})),this.handleSelectionChange(this.selection),console.log(this.selection)},handleSelectionChange:function(e){var t={selection:e,tableList:this.tableList};this.$emit("handleSelectionChange",t)},handleStatusChange:function(e){return Object(s["l"])(this.table,{id:e.id,status:e.status})},handleClick:function(e,t){this.$emit("handleEvent",e,t)},formatRow:function(e,t){switch(t.property){case"project":if(e.project){var a=this.projects.filter((function(t){return t.id==e.project}));return a&&a[0]?a[0].title:"ID:"+e.project+" 无效"}return"未关联"}}},watch:{queryParams:function(){this.getList()},refresh:function(){this.getList()}}},c=o,r=(a("8050"),a("2877")),l=Object(r["a"])(c,i,n,!1,null,"37ee11c4",null);t["default"]=l.exports},b064:function(e,t,a){},bf35:function(e,t,a){},ca07:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e.gateway?a("el-card",{staticClass:"box-card",staticStyle:{width:"350px"},attrs:{shadow:"hover"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"item"},[e._v(e._s(e.gateway.name))]),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.goDevice}},[e._v("详情")])],1),a("div",[a("div",[a("span",{staticClass:"item"},[e._v("从站地址：")]),a("span",{staticClass:"item-value"},[e._v(e._s(e.gateway.subAddr))])]),a("div",[a("span",{staticClass:"item"},[e._v("设备地址：")]),a("span",{staticClass:"item-value"},[e._v(e._s(e.gateway.addr))])]),a("div",[a("span",{staticClass:"item"},[e._v("设备位置：")]),a("span",{staticClass:"item-value"},[e._v(e._s(e.gateway.location))])])])]):a("el-empty",{attrs:{description:"未找到网关"}})],1)},n=[],s=a("5a98"),o=a("84de"),c=a("91e5"),r={inject:["reload"],components:{DeviceTable:c["default"],InputTableSelect:o["a"]},props:{device:{type:Object,default:function(){}}},data:function(){return{loading:!1,gateway:void 0}},created:function(){var e=this;this.loading=!0,Object(s["f"])(this.device.addr).then((function(t){e.loading=!1,e.gateway=t}))},methods:{goDevice:function(){var e="/device/deviceEdit?id="+this.device.id,t="/device/deviceEdit",a=this.$route.params.project;a&&(t="/"+a+t,e="/"+a+e),this.$router.push({path:t,query:{id:this.gateway.id,redirect:e}}),this.reload()}}},l=r,d=(a("8be5"),a("2877")),u=Object(d["a"])(l,i,n,!1,null,"870a63e6",null);t["default"]=u.exports},d4c0:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e.product&&"ezviz"===e.product.category?a("CameraBox",{attrs:{device:e.device,data:e.devData,env:e.env}}):a("DefaultBox",{attrs:{device:e.device,data:e.devData,env:e.env,protocol:e.protocol},on:{sendData:e.sendData}})],1)},n=[],s=(a("a9e3"),a("b64b"),a("5a98")),o=(a("870c"),a("3ea5")),c=a("c7e7"),r={components:{DefaultBox:c["default"],CameraBox:o["default"]},props:{devId:{type:[String,Number]},recvData:{type:Object,default:function(){}},env:{type:Object,default:function(){return{}}},protocol:String},data:function(){return{loading:!1,device:void 0,product:void 0,devData:void 0}},created:function(){this.queryDevice()},methods:{queryDevice:function(){var e=this;this.loading=!0,Object(s["g"])("device",this.devId).then((function(t){var a=t.data,i=a.product;i?(a.product=void 0,Object(s["g"])("product",i).then((function(t){var i=t.data;i.thing?i.thing=JSON.parse(i.thing):i.thing=[],e.product=i,a.product=i,e.device=a,e.loadAfter()}))):(e.device=a,e.loadAfter())}))},loadAfter:function(){var e=this;this.loading=!1,this.$emit("onload",this.device),Object(s["e"])({addr:this.device.addr}).then((function(t){var a={},i=t.data;for(var n in i)a[n]={ts:i.createtime,value:i[n]};e.devData=a}))},sendData:function(e,t){this.$emit("send",e,t)}},watch:{devId:function(){this.queryDevice()},recvData:function(){this.devData=this.recvData}}},l=r,d=a("2877"),u=Object(d["a"])(l,i,n,!1,null,"482d754d",null);t["default"]=u.exports},e410:function(e,t,a){},e412:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{name:"1"}},[a("template",{slot:"title"},[a("h2",[e._v("MQTT 协议接入")])]),a("div",{staticClass:"box"},[a("h3",[e._v("一机一密")]),e.device.dk&&e.device.ds?a("div",[a("div",[e._v("clientid: uzy_1_"+e._s(e.device.addr))]),a("div",[e._v("username: "+e._s(e.device.dk))]),a("div",[e._v("password: "+e._s(e.device.ds))])]):a("div",[e._v(" 未设置设备key和密钥 ")]),a("h3",[e._v("一型一密")]),e.product.pk&&e.product.ps?a("div",[a("div",[e._v("clientid: uzy_2_"+e._s(e.device.addr))]),a("div",[e._v("username: "+e._s(e.product.pk))]),a("div",[e._v("password: "+e._s(e.product.ps))])]):a("div",[e._v(" 未设置产品key和密钥 ")])])],2),a("el-collapse-item",{attrs:{name:"2"}},[a("template",{slot:"title"},[a("h2",[e._v("TCP 透传接入")])]),a("div",{staticClass:"box"},[a("h3",[e._v("一机一密")]),e.device.dk&&e.device.ds?a("div",[a("div",[e._v("注册报文: reg,1,"+e._s(e.device.addr)+","+e._s(e.device.dk)+","+e._s(e.device.ds)+"\\r\\n")]),a("div",[e._v("心跳: ping\\r\\n")])]):a("div",[e._v(" 未设置设备key和密钥 ")]),a("h3",[e._v("一型一密")]),e.product.ps&&e.product.pk?a("div",[a("div",[e._v("注册报文: reg,2,"+e._s(e.device.addr)+","+e._s(e.product.pk)+","+e._s(e.product.ps)+"\\r\\n")]),a("div",[e._v("心跳: ping\\r\\n")])]):a("div",[e._v(" 未设置产品key和密钥 ")])])],2),a("el-collapse-item",{attrs:{name:"3"}},[a("template",{slot:"title"},[a("h2",[e._v("订阅/发布")])]),a("div",{staticClass:"box"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tabTopic,stripe:""}},[a("el-table-column",{attrs:{prop:"topic",label:"Topic"}}),a("el-table-column",{attrs:{prop:"action",label:"动作"}}),a("el-table-column",{attrs:{prop:"type",label:"类型"}}),a("el-table-column",{attrs:{prop:"desc",label:"说明"}})],1)],1)],2)],1)],1)},n=[],s=(a("99af"),{components:{},props:{device:{type:Object,default:function(){return{}}},product:{type:Object,default:function(){return{}}}},data:function(){return{activeNames:["1"],tabTopic:[]}},created:function(){this.updateTopic()},methods:{updateTopic:function(){var e=[],t=this.device.addr;this.device||(t="${addr}"),this.project||(this.project="${projectId}"),this.scene||(this.scene="${sceneId}"),e=e.concat([{topic:"d/out/"+t,action:"publish",type:"sys",desc:"设备上报到平台"},{topic:"d/in/"+t,action:"subscribe",type:"sys",desc:"平台下发给设备，设备订阅"},{topic:"p/out/"+t,action:"publish",type:"sys",desc:"平台发布设备上行消息"}]),e=e.concat([{topic:"s/out/"+this.project+"/"+this.scene+"/"+t,action:"publish",type:"sys",desc:"平台发布设备上行消息"},{topic:"p/in",action:"publish",type:"sys",desc:"平台订阅，如设备控制，数据同步"}]),this.tabTopic=e}},watch:{addr:function(){this.updateTopic()},scene:function(){this.updateTopic()},project:function(){this.updateTopic()}}}),o=s,c=(a("1866"),a("2877")),r=Object(c["a"])(o,i,n,!1,null,"07dc7bbc",null);t["default"]=r.exports},e64e:function(e,t,a){"use strict";a("bf35")},fa36:function(e,t,a){"use strict";a("e410")}}]);