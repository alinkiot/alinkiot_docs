(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-868fa9ee","chunk-17c873d4","chunk-2d22d7ea"],{"0038":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{ref:"queryForm",attrs:{model:e.params,rules:e.validator,size:"small",inline:!0}},[a("SelectDevice",{on:{deviceChange:e.deviceChange}}),e.showDateRange?a("div",[e.showStep?a("el-form-item",{attrs:{label:"聚合",prop:"step"}},[a("el-select",{attrs:{placeholder:"聚合时间"},model:{value:e.step,callback:function(t){e.step=t},expression:"step"}},e._l(e.dict.type.echart_aggregate,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),a("DateTimePicker",{attrs:{options:e.dict.type.echart_aggregate,prop:"dateRange"},on:{change:e.dateChange}})],1):e._e(),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("查询")])],1)],1)},n=[],r=(a("d81d"),a("f879")),s=a("84de"),o=a("f921"),c={components:{DateTimePicker:o["a"],InputTableSelect:s["a"],SelectDevice:r["default"]},dicts:["echart_aggregate"],props:{fields:{type:Array,default:function(){return[]}},rules:{type:Object,default:function(){return{}}}},data:function(){var e=function(e,t,a){var i=e.fullField,n=e.self,r=function(){return"device"===i?!(n.device&&n.device.addr):"product"===i?!n.device&&!(n.product&&"number"===typeof n.product.id):"scene"===i&&(!n.device&&!n.scene)};r()?a(new Error(i.message)):a()},t=function(e,t,a){var i=e.fullField,n=e.self;"last"===n.dateMode&&n.dateRange>0||"range"===n.dateMode&&n.dateRange.length>0?a():a(new Error(i.message))};return{type:"product",table:"device",queryId:void 0,product:void 0,scene:void 0,device:void 0,dateRange:[],dateMode:void 0,step:"30",params:{},showDateRange:!1,showStep:!1,validator:{device:[{self:this,validator:e,required:!0,message:"设备不能为空",trigger:"blur"}],dateRange:[{self:this,validator:t,required:!0,message:"时间范围不能为空",trigger:"blur"}],product:[{self:this,validator:e,message:"产品不能为空",trigger:"blur"}],scene:[{self:this,validator:e,message:"场景不能为空",trigger:"blur"}]}}},created:function(){this.field_init()},methods:{field_init:function(){var e=this;for(var t in this.fields.map((function(t){"dateRange"===t?e.showDateRange=!0:"step"===t&&(e.showStep=!0)})),this.rules){var a=this.rules[t];a.length>0?(a.map((function(t){t.self=e})),this.validator[t]=a):delete this.validator[t]}},handleQuery:function(){var e=this;this.$refs["queryForm"].validate((function(t){t&&(e.params={device:e.device,product:e.product},e.showStep&&e.step>0&&(e.params.step=e.step),e.showDateRange&&(e.params.dateRange=e.dateRange,e.params.dateMode=e.dateMode),e.$emit("handleQuery",e.params))}))},deviceChange:function(e,t,a){this.product=e,this.device=t,this.scene=a,this.$emit("deviceChange",e,t,a),this.handleQuery()},dateChange:function(e,t){this.dateRange=t,this.dateMode=e,this.$emit("dateChange",e,t)}}},l=c,d=a("2877"),u=Object(d["a"])(l,i,n,!1,null,"85b98b66",null);t["default"]=u.exports},"010a":function(e,t,a){"use strict";a("2167")},2167:function(e,t,a){},4368:function(e,t,a){"use strict";a("5226")},5226:function(e,t,a){},8092:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("CreateQuery",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],attrs:{rules:e.rules},on:{deviceChange:e.deviceChange,handleQuery:e.handleQuery}}),0===e.columns.length?a("el-row",{attrs:{gutter:32}},[a("el-col",[a("el-empty",{attrs:{description:"暂无数据"}})],1)],1):a("el-row",[a("right-toolbar",{attrs:{component:"iot/history/list",table:e.table,columns:e.columns,showSearch:e.showSearch,menuQuery:e.menuQuery},on:{"update:showSearch":function(t){e.showSearch=t},"update:show-search":function(t){e.showSearch=t},queryTable:e.getList}}),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableList,stripe:""}},[a("el-table-column",{attrs:{align:"center",fixed:"left",label:"设备名称",prop:"device.name"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.device.name)+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"left",label:"设备地址",prop:"addr"}}),a("el-table-column",{attrs:{align:"center",fixed:"left",label:"采集时间",prop:"createtime"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.createtime?a("span",[e._v(e._s(e.parseTime(t.row.createtime)))]):a("span",[e._v("-")])]}}])}),e._l(e.columns,(function(t){return t.visible?a("el-table-column",{key:t.thing.name,attrs:{align:"center",label:t.thing.title}},[a("el-table-column",{attrs:{align:"center",prop:t.thing.name,label:t.thing.unit,formatter:e.formatRow}})],1):e._e()})),a("el-table-column",{attrs:{align:"center",label:"告警状态",prop:"levels",fixed:"right","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.levels&&t.row.levels.length>0?a("div",e._l(t.row.levels,(function(t){return a("dict-tag",{key:t.level,staticStyle:{margin:"5px"},attrs:{options:e.dict.type.iot_level,label:t.name,value:t.level}})})),1):a("div",[a("el-tag",[e._v("正常")])],1)]}}])})],2),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1)],1)},n=[],r=(a("d81d"),a("a15b"),a("4de4"),a("d3b7"),a("5a98")),s=a("a6e8"),o=a("0038"),c={name:"history",dicts:["iot_level"],components:{CreateQuery:o["default"]},data:function(){var e=function(e,t,a){var i=e.fullField,n=e.self,r=function(){return!!n.scene&&!(n.device&&n.device.addr)};r()?a(new Error(i.message)):a()};return{table:"history",desc:"实时数据",loading:!1,showSearch:!0,total:0,tableList:[],columns:[],queryParams:{addr:"",pageNum:1,pageSize:10},menuQuery:{},rules:{device:[{validator:e,message:"设备不能为空",trigger:"blur"}]}}},created:function(){},methods:{getList:function(){var e=this;this.loading=!0,Object(r["k"])("device",this.queryParams).then((function(t){var a=t.rows,i=[];a.map((function(e){i.push(e.addr)})),e.total=t.total,0===i.length?(e.loading=!1,e.tableList=[]):Object(r["e"])({addr:i.join(","),batch:!0}).then((function(t){var i=[],n=[];a.map((function(e){var a=t.data.filter((function(t){return t.addr===e.addr})),r=a[0]?a[0]:{};r.alarmrule&&n.push(r.alarmrule),r.device=e,i.push(r)})),n.length>0?Object(r["g"])("rule",n.join(",")).then((function(t){e.loading=!1,e.tableList=Object(s["f"])(i,t.data)})):(e.loading=!1,e.tableList=i)}))}))},deviceChange:function(e){this.columns=e?Object(s["g"])(e.thing):[]},handleQuery:function(e){this.queryParams.pageNum=1,this.queryParams["product"]=e.product?e.product.id:void 0,this.menuQuery["productId"]=this.queryParams.product,e.device?(this.menuQuery["deviceId"]=e.device.id,this.queryParams["addr"]=e.device.addr):(this.menuQuery["deviceId"]=void 0,this.queryParams["addr"]=void 0),this.tableList=[],this.getList()},formatRow:function(e,t){return Object(s["d"])(e,t.property,"-")}}},l=c,d=(a("4368"),a("2877")),u=Object(d["a"])(l,i,n,!1,null,"7d086e0c",null);t["default"]=u.exports},f879:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",["query"===e.view?a("el-form-item",{staticStyle:{width:"130px"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.change},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},[a("el-option",{key:"product",attrs:{label:"按产品搜索",value:"product"}}),a("el-option",{key:"scene",attrs:{label:"按场景搜索",value:"scene"}})],1)],1):e._e(),"product"===e.type?a("InputTableSelect",{attrs:{read:void 0!==e.defProductId,queryId:e.defProductId,label:"产品",showColumn:"name",table:"product",prop:"product"},on:{selectDone:e.selectProductDone}}):"scene"===e.type?a("InputTableSelect",{attrs:{label:"场景",showColumn:"title",table:"scene",prop:"scene"},on:{selectDone:e.selectSceneDone}}):e._e(),a("InputTableSelect",{attrs:{read:void 0!==e.defDeviceId,queryId:e.queryId,queryParams:e.queryParams,showColumn:"name",label:"设备",table:e.table,prop:"device"},on:{selectDone:e.selectDeviceDone}})],1)},n=[],r=(a("b64b"),a("84de")),s=a("5a98"),o={components:{InputTableSelect:r["a"]},props:{},data:function(){return{type:"product",table:"device",queryId:void 0,queryParams:void 0,product:void 0,scene:void 0,device:void 0,view:"query",defProductId:void 0,defDeviceId:void 0}},created:function(){var e=this.$route.query.deviceId,t=this.$route.query.productId;e?(this.defDeviceId=e,this.queryId=e,this.view="fix",this.type="device"):t&&(this.view="fix",this.type="product",this.defProductId=t)},methods:{selectDeviceDone:function(e){var t=this;e?(this.device=e,this.product&&e.product===this.product.id?this.doEmit():Object(s["g"])("product",e.product).then((function(e){var a=e.data;a.thing=a.thing?JSON.parse(a.thing):[],t.product=a,t.doEmit()}))):(this.product=void 0,this.device=void 0,this.queryId=void 0,this.queryParams={},this.doEmit())},selectProductDone:function(e){this.queryId=void 0,e?(this.device=void 0,"string"===typeof e.thing&&(e.thing=JSON.parse(e.thing)),this.scene=void 0,this.product=e,this.table="device",this.queryParams={product:e.id}):(this.product=void 0,this.device=void 0,this.table="device",this.queryParams={}),this.doEmit()},selectSceneDone:function(e){this.queryId=void 0,e?(this.scene=e,this.device=void 0,this.product=void 0,this.table="sceneDevice",this.queryParams={scene:this.scene.id}):(this.scene=void 0,this.device=void 0,this.table="device",this.queryParams={}),this.doEmit()},change:function(){this.queryParams={},this.queryId=void 0},doEmit:function(){this.$emit("deviceChange",this.product,this.device,this.scene)}}},c=o,l=a("2877"),d=Object(l["a"])(c,i,n,!1,null,"37688a0a",null);t["default"]=d.exports},f921:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form-item",{attrs:{label:"时间范围",prop:"dateRange"}},[a("el-select",{staticClass:"select-type input-left-sel",model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},[a("el-option",{attrs:{label:"绝对时间",value:"range"}}),a("el-option",{attrs:{label:"相对时间",value:"last"}})],1),"range"===e.type?a("el-date-picker",{staticStyle:{width:"340px"},attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{change:e.rangeChange},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}}):a("el-select",{staticClass:"input-right-sel",on:{change:e.selectChange},model:{value:e.seconds,callback:function(t){e.seconds=t},expression:"seconds"}},e._l(e.pickerOptions.shortcuts,(function(e){return a("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1)],1)},n=[],r=(a("d81d"),{components:{},props:{options:{type:Array,default:function(){return[]}}},data:function(){return{type:"last",dateRange:[],seconds:void 0,pickerOptions:{shortcuts:[]}}},created:function(){},methods:{change2shortcuts:function(){var e=this,t=[];return this.options.map((function(a){console.log("1111");var i=parseInt(a.value);i>0&&t.push({text:"最近"+a.label,value:i,onClick:function(t){e.seconds=i,e.setRange(t)}})})),t},rangeChange:function(){this.$emit("change",this.type,this.dateRange)},selectChange:function(){this.$emit("change",this.type,this.seconds)},createRange:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-1e3*this.seconds),[t,e]},setRange:function(e){e.$emit("pick",this.createRange())}},watch:{options:function(){this.pickerOptions={shortcuts:this.change2shortcuts()},this.seconds=1800,this.selectChange()}}}),s=r,o=(a("010a"),a("2877")),c=Object(o["a"])(s,i,n,!1,null,"7372b020",null);t["a"]=c.exports}}]);