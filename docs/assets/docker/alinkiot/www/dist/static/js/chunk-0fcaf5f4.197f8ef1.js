(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0fcaf5f4"],{"025a":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.device?t._e():a("el-card",{staticStyle:{"margin-bottom":"10px","border-width":"0px"},attrs:{shadow:"never"}},[a("el-steps",{attrs:{active:2,"align-center":"","finish-status":"success"}},[a("el-step",{attrs:{title:"步骤1",description:"创建产品、定义物模型"}}),a("el-step",{attrs:{title:"步骤2",description:"创建设备，关联产品"}}),a("el-step",{attrs:{title:"步骤3",description:"连接上云、查看实时数据"}})],1)],1),a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"设备地址：",prop:"addr"}},[a("el-input",{attrs:{placeholder:"请输入设备地址"},model:{value:t.form.addr,callback:function(e){t.$set(t.form,"addr",e)},expression:"form.addr"}})],1),a("el-form-item",{attrs:{label:"设备名称：",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入设备名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),a("InputTableSelect",{attrs:{queryId:t.form.product,showColumn:"name",label:"所属产品 ",table:"product",prop:"product"},on:{selectDone:t.selectProductDone}}),a("br"),a("InputTableSelect",{attrs:{queryId:t.form.project,showColumn:"title",label:"所属项目",table:"project",prop:"project"},on:{selectDone:t.selectProjectDone}}),a("el-form-item",{attrs:{label:"安装位置：",prop:"location"}},[a("MapSelector",{attrs:{location:t.form.location,lat:t.form.lat,lng:t.form.lng},on:{selectDone:t.selectMapDone}})],1),a("el-form-item",{attrs:{label:"禁用状态：",prop:"status"}},[a("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.dict.type.sys_normal_disable,(function(e){return a("el-radio",{key:e.value,attrs:{label:e.value}},[t._v(t._s(e.label)+" ")])})),1)],1),a("el-form-item",[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.submitForm}},[t._v("保存")])],1)],1)],1)],1)},i=[],l=(a("b0c0"),a("84de")),n=a("19c8"),r=a("5a98"),s=a("a6e8"),c={components:{InputTableSelect:l["a"],MapSelector:n["a"]},dicts:["sys_normal_disable"],props:{device:{type:Object,default:function(){}}},data:function(){return{loading:!1,table:"device",form:{status:"0"},product:void 0,project:void 0,rules:{addr:[{required:!0,validator:s["h"],message:"设备地址只能为0-9、a-z、A-Z",trigger:"blur"}],name:[{required:!0,message:"设备名称不能为空",trigger:"blur"}],nodeType:[{required:!0,message:"设备类型不能为空",trigger:"blur"}],product:[{self:this,validator:s["j"],required:!0,message:"所属产品不能为空",trigger:"blur"}]}}},created:function(){this.device&&(this.form={id:this.device.id,addr:this.device.addr,name:this.device.name,product:this.device.product,project:this.device.project,location:this.device.location,lat:this.device.lat,lng:this.device.lng,status:this.device.status})},methods:{reset:function(){this.product=void 0,this.project=void 0,this.form={status:"0"}},submitForm:function(){var t=this;this.$refs["form"].validate((function(e){e&&(t.loading=!0,t.device?Object(r["l"])(t.table,t.form).then((function(e){t.$modal.msgSuccess("修改成功!"),t.loading=!1,t.$emit("onUpdate",t.form)})):Object(r["a"])(t.table,t.form).then((function(e){t.$modal.msgSuccess("新增成功!"),t.loading=!1,t.$emit("onCreate",t.form),t.reset()})))}))},selectMapDone:function(t){this.form.location=t.location,this.form.country=t.country,this.form.province=t.province,this.form.district=t.district,this.form.lat=t.lat,this.form.lng=t.lng},selectProjectDone:function(t){this.project=t,t?this.form.project=this.project.id:(this.form.project=void 0,this.device.project=void 0)},selectProductDone:function(t){this.product=t,t?this.form.product=this.product.id:(this.form.product=void 0,this.device.product=void 0)}}},d=c,p=a("2877"),m=Object(p["a"])(d,o,i,!1,null,"022e5996",null);e["default"]=m.exports},"19c8":function(t,e,a){"use strict";var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",[t.readonly?t.isEmpty?a("el-tag",{attrs:{type:"info"}},[t._v("未设置")]):a("p",[t._v(" "+t._s(t.location)+" "),a("el-button",{attrs:{type:"text"},on:{click:t.handleSelect}},[a("i",{staticClass:"el-icon-position el-icon--right"})])],1):a("p",[t.isEmpty?[t._v("设置")]:[t._v(t._s(t.data.location))],a("el-button",{attrs:{type:"text"},on:{click:t.handleSelect}},[a("i",{staticClass:"el-icon-edit el-icon--right"})])],2),a("el-dialog",{staticClass:"mapDialog",attrs:{title:t.readonly?"查看位置":"选择位置",visible:t.openSelector,"append-to-body":""},on:{"update:visible":function(e){t.openSelector=e}}},[t.readonly?""!==t.data.location?a("div",[a("h3",[a("i",{staticClass:"el-icon-position"}),t._v(t._s(t.data.location))])]):a("h3",[t._v("未设置")]):a("el-input",{attrs:{placeholder:"请输入设备位置"},model:{value:t.data.location,callback:function(e){t.$set(t.data,"location",e)},expression:"data.location"}},[a("el-button",{attrs:{slot:"append",type:"primary"},on:{click:t.selectDone},slot:"append"},[t._v("确定")])],1),a("div",{staticStyle:{margin:"10px 0px 10px 0px"}},[a("el-tag",[t._v("纬度:"+t._s(t.data.lat))]),a("el-tag",{staticStyle:{"margin-left":"10px"}},[t._v("经度:"+t._s(t.data.lng))])],1),a("div",{staticClass:"amap-wrapper"},[t.readonly?t._e():a("el-amap-search-box",{staticClass:"amap-search-box",attrs:{"search-option":t.searchOption,"on-search-result":t.onSearchResult}}),a("el-amap",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{vid:"amapDev",zoom:t.zoom,"map-style":t.styleName,center:t.center,plugin:t.plugins,"amap-manager":t.amapManager,events:t.events}})],1)],1)],1)},i=[],l=(a("a9e3"),a("ac1f"),a("00b4"),a("b0c0"),a("8f9b")),n=a("870c"),r=new l["AMapManager"],s={components:{},props:{name:{type:String,default:void 0},location:{type:String,default:void 0},lat:{type:Number,default:void 0},lng:{type:Number,default:void 0},readonly:{type:Boolean,default:!1}},computed:{styleName:function(){var t=this.$store.state.settings.sideTheme;return/theme-dark-.+/.test(t)?"amap://styles/blue":"amap://styles/normal"}},data:function(){var t=this;return{loading:!1,title:"",data:{location:void 0,lat:void 0,lng:void 0},isEmpty:!0,amapManager:r,plugins:["ToolBar","Autocomplete","OverView","Geocoder"],zoom:15,center:[121.59996,31.197646],openSelector:!1,searchOption:{city:"",citylimit:!1},events:{complete:function(e){t.data.lat&&t.data.lng&&t.setMarker(t.data)},click:function(e){t.loading=!0,t.data.lat=e.lnglat.lat,t.data.lng=e.lnglat.lng,t.setMarker(e.lnglat);var a=new AMap.Geocoder({});a.getAddress(e.lnglat,(function(e,a){t.loading=!1,"complete"===e&&a.regeocode&&(t.data.country=a.regeocode.addressComponent.country,t.data.province=a.regeocode.addressComponent.province,t.data.district=a.regeocode.addressComponent.district,t.data.location=a.regeocode.formattedAddress,t.setEmpty())}))}}}},created:function(){this.data={location:this.location,lng:this.lng,lat:this.lat},this.setEmpty(),Object(n["e"])(this)},methods:{setEmpty:function(){this.isEmpty=void 0===this.data.location||""===this.data.location},setMarker:function(t){t.Q=t.lat,t.R=t.lng;var e=r.getMap();this.marker&&(e.remove(this.marker),e.setFitView()),this.marker=new AMap.Marker({map:e}),this.center=[t.lng,t.lat],this.marker.setPosition(t)},selectDone:function(){var t=this.data;t.name=this.name,this.$emit("selectDone",t),this.openSelector=!1},handleSelect:function(){this.openSelector=!0},onSearchResult:function(t){if(t.length>0){var e=t[0];this.center=[e.lng,e.lat],this.data.location=e.address,this.data.lat=e.lat,this.data.lng=e.lng}}},watch:{readonly:function(){this.title=this.readonly?"查看位置":"选择位置"},location:function(){this.data={location:this.location,lat:this.lat?this.lat:"-",lng:this.lng?this.lng:"-"},this.setEmpty()}}},c=s,d=(a("2bab"),a("2877")),p=Object(d["a"])(c,o,i,!1,null,"2eae3cf5",null);e["a"]=p.exports},"2bab":function(t,e,a){"use strict";a("c0e8")},c0e8:function(t,e,a){}}]);