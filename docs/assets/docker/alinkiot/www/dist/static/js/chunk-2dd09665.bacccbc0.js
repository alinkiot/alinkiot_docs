(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2dd09665","chunk-7e2489be"],{"0cbf":function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[t.product?t._e():o("el-card",{staticStyle:{"margin-bottom":"10px","border-width":"0px"},attrs:{shadow:"never"}},[o("el-steps",{attrs:{active:0,"align-center":"","finish-status":"success"}},[o("el-step",{attrs:{title:"步骤1",description:"创建产品、定义物模型"}}),o("el-step",{attrs:{title:"步骤2",description:"创建设备，关联产品"}}),o("el-step",{attrs:{title:"步骤3",description:"连接上云、查看实时数据"}})],1)],1),o("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"80px"}},[o("el-form-item",{attrs:{label:"产品名称",prop:"name"}},[o("el-input",{attrs:{placeholder:"请输入产品名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),o("el-form-item",{attrs:{label:"设备类型",prop:"nodeType"}},[o("el-radio-group",{model:{value:t.form.nodeType,callback:function(e){t.$set(t.form,"nodeType",e)},expression:"form.nodeType"}},t._l(t.dict.type.iot_node_type,(function(e){return o("el-radio",{key:e.value,attrs:{label:e.value}},[t._v(t._s(e.label)+" ")])})),1)],1),o("el-form-item",{attrs:{label:"产品分类",prop:"category"}},[o("el-select",{attrs:{placeholder:"请选择产品分类"},model:{value:t.form.category,callback:function(e){t.$set(t.form,"category",e)},expression:"form.category"}},t._l(t.dict.type.iot_product_mgr,(function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),o("el-button",{staticStyle:{"margin-left":"5px"},attrs:{size:"small",type:"primary",icon:"el-icon-plus",circle:""},on:{click:function(e){return t.addDict("iot_product_mgr")}}})],1),o("el-form-item",{attrs:{label:"协议标识",prop:"protocol"}},[o("el-select",{attrs:{placeholder:"协议标识"},model:{value:t.form.protocol,callback:function(e){t.$set(t.form,"protocol",e)},expression:"form.protocol"}},t._l(t.dict.type.iot_protocol_id,(function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),o("el-button",{staticStyle:{"margin-left":"5px"},attrs:{size:"small",type:"primary",icon:"el-icon-plus",circle:""},on:{click:function(e){return t.addDict("iot_protocol_id")}}})],1),o("el-form-item",{attrs:{label:"注册类型",prop:"autoRegister"}},[o("el-select",{attrs:{placeholder:"是否自动注册"},model:{value:t.form.autoRegister,callback:function(e){t.$set(t.form,"autoRegister",e)},expression:"form.autoRegister"}},t._l(t.dict.type.iot_auto_register,(function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),o("el-form-item",{attrs:{label:"通讯方式",prop:"netType"}},[o("el-select",{attrs:{placeholder:"请选择通讯方式"},model:{value:t.form.netType,callback:function(e){t.$set(t.form,"netType",e)},expression:"form.netType"}},t._l(t.dict.type.iot_net_type,(function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),o("el-button",{staticStyle:{"margin-left":"5px"},attrs:{size:"small",type:"primary",icon:"el-icon-plus",circle:""},on:{click:function(e){return t.addDict("iot_net_type")}}})],1),o("el-form-item",{attrs:{label:"产品图片",prop:"img"}},[o("ImageUpload",{attrs:{limit:1,value:t.form.img},on:{input:t.handleFile}})],1),o("el-form-item",{attrs:{label:"说明链接",prop:"doc"}},[o("el-input",{attrs:{placeholder:"请输入该设备说明文档"},model:{value:t.form.doc,callback:function(e){t.$set(t.form,"doc",e)},expression:"form.doc"}})],1),o("el-form-item",{attrs:{label:"是否禁用",prop:"status"}},[o("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.dict.type.sys_normal_disable,(function(e){return o("el-radio",{key:e.value,attrs:{label:e.value}},[t._v(t._s(e.label)+" ")])})),1)],1),o("el-form-item",[o("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.submitForm}},[t._v("保存")])],1)],1)],1)},i=[],l=(o("b0c0"),o("0835")),r=o("84de"),n=o("5a98"),c={name:"ProductEdit",props:{product:{type:Object,default:function(){}}},dicts:["sys_normal_disable","iot_protocol_id","iot_net_type","iot_auto_register","iot_node_type","iot_product_mgr"],components:{InputTableSelect:r["a"],ImageUpload:l["a"]},data:function(){return{form:{status:"0",nodeType:"device"},loading:!1,rules:{name:[{required:!0,message:"产品名称不能为空",trigger:"blur"}],autoRegister:[{required:!0,message:"是否自动注册不能为空",trigger:"blur"}],protocol:[{required:!0,message:"协议标识不能为空",trigger:"blur"}],category:[{required:!0,message:"品类不能为空",trigger:"blur"}],nodeType:[{required:!0,message:"节点类型不能为空",trigger:"blur"}]}}},created:function(){this.product&&(this.form={id:this.product.id,name:this.product.name,nodeType:this.product.nodeType,category:this.product.category,protocol:this.product.protocol,autoRegister:this.product.autoRegister,netType:this.product.netType,doc:this.product.doc,status:this.product.status,img:this.product.img})},methods:{reset:function(){this.form={status:"0",nodeType:"device"}},addDict:function(t){this.$router.push({path:"/system/dict-data/index/"+t})},handleFile:function(t){this.form.img=t},submitForm:function(){var t=this;this.$refs["form"].validate((function(e){e&&(t.product?Object(n["l"])("product",t.form).then((function(e){t.$modal.msgSuccess("修改成功"),t.$emit("onUpdate",t.form)})):Object(n["a"])("product",t.form).then((function(e){t.$modal.msgSuccess("新增成功"),t.$emit("onCreate",t.form),t.reset()})))}))}}},s=c,p=(o("793c"),o("2877")),d=Object(p["a"])(s,a,i,!1,null,"87ded5be",null);e["default"]=d.exports},"19c8":function(t,e,o){"use strict";var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("span",[t.readonly?t.isEmpty?o("el-tag",{attrs:{type:"info"}},[t._v("未设置")]):o("p",[t._v(" "+t._s(t.location)+" "),o("el-button",{attrs:{type:"text"},on:{click:t.handleSelect}},[o("i",{staticClass:"el-icon-position el-icon--right"})])],1):o("p",[t.isEmpty?[t._v("设置")]:[t._v(t._s(t.data.location))],o("el-button",{attrs:{type:"text"},on:{click:t.handleSelect}},[o("i",{staticClass:"el-icon-edit el-icon--right"})])],2),o("el-dialog",{staticClass:"mapDialog",attrs:{title:t.readonly?"查看位置":"选择位置",visible:t.openSelector,"append-to-body":""},on:{"update:visible":function(e){t.openSelector=e}}},[t.readonly?""!==t.data.location?o("div",[o("h3",[o("i",{staticClass:"el-icon-position"}),t._v(t._s(t.data.location))])]):o("h3",[t._v("未设置")]):o("el-input",{attrs:{placeholder:"请输入设备位置"},model:{value:t.data.location,callback:function(e){t.$set(t.data,"location",e)},expression:"data.location"}},[o("el-button",{attrs:{slot:"append",type:"primary"},on:{click:t.selectDone},slot:"append"},[t._v("确定")])],1),o("div",{staticStyle:{margin:"10px 0px 10px 0px"}},[o("el-tag",[t._v("纬度:"+t._s(t.data.lat))]),o("el-tag",{staticStyle:{"margin-left":"10px"}},[t._v("经度:"+t._s(t.data.lng))])],1),o("div",{staticClass:"amap-wrapper"},[t.readonly?t._e():o("el-amap-search-box",{staticClass:"amap-search-box",attrs:{"search-option":t.searchOption,"on-search-result":t.onSearchResult}}),o("el-amap",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{vid:"amapDev",zoom:t.zoom,"map-style":t.styleName,center:t.center,plugin:t.plugins,"amap-manager":t.amapManager,events:t.events}})],1)],1)],1)},i=[],l=(o("a9e3"),o("ac1f"),o("00b4"),o("b0c0"),o("8f9b")),r=o("870c"),n=new l["AMapManager"],c={components:{},props:{name:{type:String,default:void 0},location:{type:String,default:void 0},lat:{type:Number,default:void 0},lng:{type:Number,default:void 0},readonly:{type:Boolean,default:!1}},computed:{styleName:function(){var t=this.$store.state.settings.sideTheme;return/theme-dark-.+/.test(t)?"amap://styles/blue":"amap://styles/normal"}},data:function(){var t=this;return{loading:!1,title:"",data:{location:void 0,lat:void 0,lng:void 0},isEmpty:!0,amapManager:n,plugins:["ToolBar","Autocomplete","OverView","Geocoder"],zoom:15,center:[121.59996,31.197646],openSelector:!1,searchOption:{city:"",citylimit:!1},events:{complete:function(e){t.data.lat&&t.data.lng&&t.setMarker(t.data)},click:function(e){t.loading=!0,t.data.lat=e.lnglat.lat,t.data.lng=e.lnglat.lng,t.setMarker(e.lnglat);var o=new AMap.Geocoder({});o.getAddress(e.lnglat,(function(e,o){t.loading=!1,"complete"===e&&o.regeocode&&(t.data.country=o.regeocode.addressComponent.country,t.data.province=o.regeocode.addressComponent.province,t.data.district=o.regeocode.addressComponent.district,t.data.location=o.regeocode.formattedAddress,t.setEmpty())}))}}}},created:function(){this.data={location:this.location,lng:this.lng,lat:this.lat},this.setEmpty(),Object(r["e"])(this)},methods:{setEmpty:function(){this.isEmpty=void 0===this.data.location||""===this.data.location},setMarker:function(t){t.Q=t.lat,t.R=t.lng;var e=n.getMap();this.marker&&(e.remove(this.marker),e.setFitView()),this.marker=new AMap.Marker({map:e}),this.center=[t.lng,t.lat],this.marker.setPosition(t)},selectDone:function(){var t=this.data;t.name=this.name,this.$emit("selectDone",t),this.openSelector=!1},handleSelect:function(){this.openSelector=!0},onSearchResult:function(t){if(t.length>0){var e=t[0];this.center=[e.lng,e.lat],this.data.location=e.address,this.data.lat=e.lat,this.data.lng=e.lng}}},watch:{readonly:function(){this.title=this.readonly?"查看位置":"选择位置"},location:function(){this.data={location:this.location,lat:this.lat?this.lat:"-",lng:this.lng?this.lng:"-"},this.setEmpty()}}},s=c,p=(o("2bab"),o("2877")),d=Object(p["a"])(s,a,i,!1,null,"2eae3cf5",null);e["a"]=d.exports},"2bab":function(t,e,o){"use strict";o("c0e8")},"34cf":function(t,e,o){"use strict";var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[t.buttons.length>0||t.title?o("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t.title?o("span",{staticStyle:{"font-weight":"bold","line-height":"40px"}},[t._v(t._s(t.title))]):t._e(),o("el-button-group",{staticStyle:{float:"right",padding:"3px 0"}},t._l(t.buttons,(function(e){return o("el-button",{key:e.key,class:e.icon,staticStyle:{"margin-right":"5px"},attrs:{type:"text"},on:{click:function(o){return t.doClick(e)}}},[t._v(t._s(e.title))])})),1)],1):t._e(),t.columns.length>0?o("el-row",{staticClass:"tab-body"},t._l(t.columns,(function(e){return o("el-col",{key:e.key,staticClass:"tab-col",attrs:{xs:24,sm:12,md:8,lg:8,xl:6}},[o("div",{staticClass:"td-title"},[t._v(t._s(e.title))]),o("div",{staticClass:"td-value"},["map"===e.type?[o("MapSelector",{attrs:{name:e.key,location:t.getValue(e),lat:t.getLngLat("lat",e),lng:t.getLngLat("lng",e)},on:{selectDone:t.selectMapDone}})]:"dict"===e.type?[o("dict-tag",{attrs:{options:e.options,value:t.getValue(e)}})]:t.checkEmpty(e)?[t._v("--")]:["href"===e.type?[o("el-link",{attrs:{type:"primary","underline:":"true",href:t.getValue(e),target:"_blank"}},[t._v("访问")])]:"image"===e.type?[o("ImagePreview",{staticStyle:{width:"20px"},attrs:{src:t.getValue(e)}})]:"secret"===e.type?[o("span",{staticClass:"secret-box"},[t._v("******")]),o("el-popover",{attrs:{placement:"bottom",title:e.title+":",width:"200",trigger:"click",content:t.getValue(e)}},[o("el-button",{attrs:{slot:"reference",type:"text",icon:"el-icon-view"},slot:"reference"})],1)]:[t._v(" "+t._s(t.getValue(e))+" ")]],e.click?o("el-button",{attrs:{type:"text",icon:e.click.icon,circle:""},on:{click:function(o){return t.doClick(e)}}},[e.click.title?[t._v(" "+t._s(e.click.title)+" ")]:t._e()],2):t._e()],2)])})),1):o("el-empty",{attrs:{description:"暂无"+t.title}})],1)},i=[],l=(o("b0c0"),o("4de4"),o("d3b7"),o("a15b"),o("5a0c")),r=o.n(l),n=o("9a2d"),c=o("19c8"),s={components:{MapSelector:c["a"],ImagePreview:n["a"]},props:{title:{type:String,default:void 0},columns:{type:Array,default:function(){return[]}},item:{type:Object,default:function(){return{}}},buttons:{type:Array,default:function(){return[]}}},data:function(){return{}},created:function(){},methods:{checkEmpty:function(t){var e=this.getValue(t);return null===e||void 0===e||""===e},doClick:function(t){this.$emit("click",t)},selectMapDone:function(t){var e=t.name,o=this.columns.filter((function(t){return t.key===e}));if(o.length>0){var a=o[0];this.$emit("selectMapDone",a,t)}},getLngLat:function(t,e){var o=e[t];return this.item[o]},getValue:function(t){var e=t.key,o=t.format,a=this.item[e];if("relation"===t.type){var i=t.on,l=this.item[i];return o?o(e,{field:l,key:a}):l||a?(l=l||"--",a=a||"--",[a,l].join(",")):void 0}return"datetime"===t.type?a?r()(1e3*a).format("YYYY-MM-DD HH:mm:ss"):void 0:o?o(e,a):a}}},p=s,d=(o("d8ff"),o("2877")),u=Object(d["a"])(p,a,i,!1,null,"111fd298",null);e["a"]=u.exports},"793c":function(t,e,o){"use strict";o("bc63")},"93f7":function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("el-row",[o("el-col",{attrs:{span:t.product&&t.product.img?18:24}},[t.product?o("TableShow",{attrs:{title:"基本信息",columns:t.product_columns,item:t.product,buttons:t.buttons},on:{click:t.onClick}}):t._e()],1),t.product&&t.product.img?o("el-col",{staticStyle:{"text-align":"center"},attrs:{span:6}},[o("ImagePreview",{staticStyle:{width:"80%"},attrs:{src:t.product.img}})],1):t._e()],1),o("el-drawer",{attrs:{title:"编辑产品",visible:t.openEditDialog,direction:"rtl",size:"40%"},on:{"update:visible":function(e){t.openEditDialog=e}}},[o("ProductForm",{staticStyle:{padding:"10px"},attrs:{product:t.product},on:{onUpdate:t.onUpdate}})],1),o("el-dialog",{attrs:{title:"设置产品密钥",visible:t.openSecretSelector},on:{"update:visible":function(e){t.openSecretSelector=e}}},[o("el-form",{ref:"keyForm",attrs:{"status-icon":"",rules:t.keyFormRule,model:t.secret,"label-width":"80px",prop:"keyForm"}},[o("el-form-item",{attrs:{label:"产品Key",prop:"key"}},[o("el-input",{attrs:{placeholder:"请输入产品Key"},model:{value:t.secret.key,callback:function(e){t.$set(t.secret,"key",e)},expression:"secret.key"}},[o("el-button",{attrs:{slot:"append",type:"text",icon:"el-icon-refresh",circle:""},on:{click:t.createKey},slot:"append"})],1)],1),o("el-form-item",{attrs:{label:"产品密钥",prop:"secret"}},[o("el-input",{attrs:{placeholder:"请输入产品密钥"},model:{value:t.secret.value,callback:function(e){t.$set(t.secret,"value",e)},expression:"secret.value"}},[o("el-button",{attrs:{slot:"append",type:"text",icon:"el-icon-refresh",circle:""},on:{click:t.createSecret},slot:"append"})],1)],1),o("el-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{title:"警告:更新密钥会导致旧设备无法连接!",type:"warning",closable:!1}}),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:t.addSecretDone}},[t._v("更新")])],1)],1)],1)],1)},i=[],l=(o("a9e3"),o("34cf")),r=o("5a98"),n=o("0cbf"),c=o("a6e8"),s={components:{ProductForm:n["default"],TableShow:l["a"]},dicts:["sys_normal_disable","iot_node_type","iot_net_type","iot_auto_register","iot_product_mgr","iot_protocol_id"],props:{id:{type:[String,Number],default:void 0}},data:function(){return{product_columns:[],openSecretSelector:!1,secret:{key:"",value:""},product:void 0,openEditDialog:!1,buttons:[{icon:"el-icon-edit-outline",key:"editProduct",title:"编辑"}],keyFormRule:{key:[{required:!0,len:8,validator:c["b"],message:"只能大小写字母，数字组成的8位字符串",trigger:"blur"}],value:[{required:!0,len:16,validator:c["b"],message:"只能大小写字母，数字组成的16位字符串",trigger:"blur"}]}}},created:function(){this.product_columns=[{key:"name",title:"产品名称",type:"text"},{key:"autoRegister",title:"自动注册",type:"dict",options:this.dict.type.iot_auto_register},{key:"nodeType",title:"节点类型",type:"dict",options:this.dict.type.iot_node_type},{key:"netType",title:"网络类型",type:"dict",options:this.dict.type.iot_net_type},{key:"pk",title:"产品Key",type:"text",click:{icon:"el-icon-refresh"}},{key:"ps",title:"产品密钥",type:"secret",click:{icon:"el-icon-refresh"}},{key:"category",title:"产品分类",type:"dict",options:this.dict.type.iot_product_mgr},{key:"protocol",title:"协议标识",type:"dict",options:this.dict.type.iot_protocol_id},{key:"status",title:"是否停用",type:"dict",options:this.dict.type.sys_normal_disable},{key:"doc",title:"帮助文档",type:"href"}],this.load()},methods:{onClick:function(t){console.log(t),"editProduct"===t.key?this.openEditDialog=!0:"ps"!==t.key&&"pk"!==t.key||(this.secret={key:this.product.pk,value:this.product.ps},this.openSecretSelector=!0)},createSecret:function(){this.secret.value=Object(c["e"])(16)},createKey:function(){this.secret.key=Object(c["e"])(8)},load:function(){var t=this;Object(r["g"])("product",this.id).then((function(e){t.product=e.data,t.$emit("onload",t.product)}))},onUpdate:function(t){this.load(),this.openEditDialog=!1},addSecretDone:function(){var t=this;this.$refs["keyForm"].validate((function(e){if(e){var o={id:t.product.id,pk:t.secret.key,ps:t.secret.value};Object(r["l"])("product",o).then((function(e){200===e.code?(t.product.pk=t.secret.key,t.product.ps=t.secret.value,t.$modal.msgSuccess("保存成功！"),t.openSecretSelector=!1):t.$modal.msgError("保存失败！")}))}}))}}},p=s,d=o("2877"),u=Object(d["a"])(p,a,i,!1,null,"07984008",null);e["default"]=u.exports},"9b59":function(t,e,o){},bc63:function(t,e,o){},c0e8:function(t,e,o){},d8ff:function(t,e,o){"use strict";o("9b59")}}]);