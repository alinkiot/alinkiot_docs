(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-17c873d4","chunk-2d22d7ea"],{"0038":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-form",{ref:"queryForm",attrs:{model:e.params,rules:e.validator,size:"small",inline:!0}},[i("SelectDevice",{on:{deviceChange:e.deviceChange}}),e.showDateRange?i("div",[e.showStep?i("el-form-item",{attrs:{label:"聚合",prop:"step"}},[i("el-select",{attrs:{placeholder:"聚合时间"},model:{value:e.step,callback:function(t){e.step=t},expression:"step"}},e._l(e.dict.type.echart_aggregate,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),i("DateTimePicker",{attrs:{options:e.dict.type.echart_aggregate,prop:"dateRange"},on:{change:e.dateChange}})],1):e._e(),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("查询")])],1)],1)},s=[],n=(i("d81d"),i("f879")),r=i("84de"),o=i("f921"),c={components:{DateTimePicker:o["a"],InputTableSelect:r["a"],SelectDevice:n["default"]},dicts:["echart_aggregate"],props:{fields:{type:Array,default:function(){return[]}},rules:{type:Object,default:function(){return{}}}},data:function(){var e=function(e,t,i){var a=e.fullField,s=e.self,n=function(){return"device"===a?!(s.device&&s.device.addr):"product"===a?!s.device&&!(s.product&&"number"===typeof s.product.id):"scene"===a&&(!s.device&&!s.scene)};n()?i(new Error(a.message)):i()},t=function(e,t,i){var a=e.fullField,s=e.self;"last"===s.dateMode&&s.dateRange>0||"range"===s.dateMode&&s.dateRange.length>0?i():i(new Error(a.message))};return{type:"product",table:"device",queryId:void 0,product:void 0,scene:void 0,device:void 0,dateRange:[],dateMode:void 0,step:"30",params:{},showDateRange:!1,showStep:!1,validator:{device:[{self:this,validator:e,required:!0,message:"设备不能为空",trigger:"blur"}],dateRange:[{self:this,validator:t,required:!0,message:"时间范围不能为空",trigger:"blur"}],product:[{self:this,validator:e,message:"产品不能为空",trigger:"blur"}],scene:[{self:this,validator:e,message:"场景不能为空",trigger:"blur"}]}}},created:function(){this.field_init()},methods:{field_init:function(){var e=this;for(var t in this.fields.map((function(t){"dateRange"===t?e.showDateRange=!0:"step"===t&&(e.showStep=!0)})),this.rules){var i=this.rules[t];i.length>0?(i.map((function(t){t.self=e})),this.validator[t]=i):delete this.validator[t]}},handleQuery:function(){var e=this;this.$refs["queryForm"].validate((function(t){t&&(e.params={device:e.device,product:e.product},e.showStep&&e.step>0&&(e.params.step=e.step),e.showDateRange&&(e.params.dateRange=e.dateRange,e.params.dateMode=e.dateMode),e.$emit("handleQuery",e.params))}))},deviceChange:function(e,t,i){this.product=e,this.device=t,this.scene=i,this.$emit("deviceChange",e,t,i),this.handleQuery()},dateChange:function(e,t){this.dateRange=t,this.dateMode=e,this.$emit("dateChange",e,t)}}},d=c,l=i("2877"),u=Object(l["a"])(d,a,s,!1,null,"85b98b66",null);t["default"]=u.exports},"010a":function(e,t,i){"use strict";i("2167")},2167:function(e,t,i){},f879:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",["query"===e.view?i("el-form-item",{staticStyle:{width:"130px"}},[i("el-select",{attrs:{placeholder:"请选择"},on:{change:e.change},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},[i("el-option",{key:"product",attrs:{label:"按产品搜索",value:"product"}}),i("el-option",{key:"scene",attrs:{label:"按场景搜索",value:"scene"}})],1)],1):e._e(),"product"===e.type?i("InputTableSelect",{attrs:{read:void 0!==e.defProductId,queryId:e.defProductId,label:"产品",showColumn:"name",table:"product",prop:"product"},on:{selectDone:e.selectProductDone}}):"scene"===e.type?i("InputTableSelect",{attrs:{label:"场景",showColumn:"title",table:"scene",prop:"scene"},on:{selectDone:e.selectSceneDone}}):e._e(),i("InputTableSelect",{attrs:{read:void 0!==e.defDeviceId,queryId:e.queryId,queryParams:e.queryParams,showColumn:"name",label:"设备",table:e.table,prop:"device"},on:{selectDone:e.selectDeviceDone}})],1)},s=[],n=(i("b64b"),i("84de")),r=i("5a98"),o={components:{InputTableSelect:n["a"]},props:{},data:function(){return{type:"product",table:"device",queryId:void 0,queryParams:void 0,product:void 0,scene:void 0,device:void 0,view:"query",defProductId:void 0,defDeviceId:void 0}},created:function(){var e=this.$route.query.deviceId,t=this.$route.query.productId;e?(this.defDeviceId=e,this.queryId=e,this.view="fix",this.type="device"):t&&(this.view="fix",this.type="product",this.defProductId=t)},methods:{selectDeviceDone:function(e){var t=this;e?(this.device=e,this.product&&e.product===this.product.id?this.doEmit():Object(r["g"])("product",e.product).then((function(e){var i=e.data;i.thing=i.thing?JSON.parse(i.thing):[],t.product=i,t.doEmit()}))):(this.product=void 0,this.device=void 0,this.queryId=void 0,this.queryParams={},this.doEmit())},selectProductDone:function(e){this.queryId=void 0,e?(this.device=void 0,"string"===typeof e.thing&&(e.thing=JSON.parse(e.thing)),this.scene=void 0,this.product=e,this.table="device",this.queryParams={product:e.id}):(this.product=void 0,this.device=void 0,this.table="device",this.queryParams={}),this.doEmit()},selectSceneDone:function(e){this.queryId=void 0,e?(this.scene=e,this.device=void 0,this.product=void 0,this.table="sceneDevice",this.queryParams={scene:this.scene.id}):(this.scene=void 0,this.device=void 0,this.table="device",this.queryParams={}),this.doEmit()},change:function(){this.queryParams={},this.queryId=void 0},doEmit:function(){this.$emit("deviceChange",this.product,this.device,this.scene)}}},c=o,d=i("2877"),l=Object(d["a"])(c,a,s,!1,null,"37688a0a",null);t["default"]=l.exports},f921:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-form-item",{attrs:{label:"时间范围",prop:"dateRange"}},[i("el-select",{staticClass:"select-type input-left-sel",model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},[i("el-option",{attrs:{label:"绝对时间",value:"range"}}),i("el-option",{attrs:{label:"相对时间",value:"last"}})],1),"range"===e.type?i("el-date-picker",{staticStyle:{width:"340px"},attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{change:e.rangeChange},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}}):i("el-select",{staticClass:"input-right-sel",on:{change:e.selectChange},model:{value:e.seconds,callback:function(t){e.seconds=t},expression:"seconds"}},e._l(e.pickerOptions.shortcuts,(function(e){return i("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1)],1)},s=[],n=(i("d81d"),{components:{},props:{options:{type:Array,default:function(){return[]}}},data:function(){return{type:"last",dateRange:[],seconds:void 0,pickerOptions:{shortcuts:[]}}},created:function(){},methods:{change2shortcuts:function(){var e=this,t=[];return this.options.map((function(i){console.log("1111");var a=parseInt(i.value);a>0&&t.push({text:"最近"+i.label,value:a,onClick:function(t){e.seconds=a,e.setRange(t)}})})),t},rangeChange:function(){this.$emit("change",this.type,this.dateRange)},selectChange:function(){this.$emit("change",this.type,this.seconds)},createRange:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-1e3*this.seconds),[t,e]},setRange:function(e){e.$emit("pick",this.createRange())}},watch:{options:function(){this.pickerOptions={shortcuts:this.change2shortcuts()},this.seconds=1800,this.selectChange()}}}),r=n,o=(i("010a"),i("2877")),c=Object(o["a"])(r,a,s,!1,null,"7372b020",null);t["a"]=c.exports}}]);