(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f3d6cca6"],{6137:function(t,e,a){},8050:function(t,e,a){"use strict";a("6137")},"91e5":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.queryParams?a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[t.tableList.length>0?a("div",["card"===t.showType?a("el-row",{attrs:{gutter:10}},t._l(t.tableList,(function(e){return a("el-col",{key:e.addr,staticStyle:{"margin-bottom":"10px"},attrs:{xs:t.size[0],sm:t.size[1],md:t.size[2],lg:t.size[3],xl:t.size[4]}},[a("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[a("el-checkbox",{on:{change:function(a){return t.handleCardSelectionChange(a,e)}}}),a("el-button",{staticClass:"card-title",attrs:{type:"text"}},[t._v(t._s(e.name))])],1),a("div",{staticStyle:{float:"right"}},[t.isShow("netType")?a("dict-tag",{attrs:{options:t.dict.type.iot_net_type,value:e.product.netType}}):t._e()],1)]),a("el-container",[a("el-main",{staticStyle:{padding:"0px"}},[a("div",{staticClass:"card-row"},[t.isShow("nodeType")?a("dict-tag",{attrs:{options:t.dict.type.iot_node_type,value:e.product.nodeType}}):t._e(),"ezviz"!==e.product.category?a("span",[e.lastOnline?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"上线时间："+t.parseTime(e.lastOnline),placement:"bottom"}},[a("dict-tag",{attrs:{options:t.dict.type.iot_device_status,value:e.online}})],1):a("dict-tag",{attrs:{options:t.dict.type.iot_device_status,value:e.online}})],1):t._e(),t.isShow("status")&&"1"===e.status?a("el-tag",{attrs:{type:"danger"}},[t._v("禁用")]):t._e()],1),t.isShow("subAddr")?a("div",{staticClass:"card-row"},[a("span",{staticClass:"card-row-header"},[t._v("从站地址: ")]),t._v(t._s(e.subAddr)+" ")]):t._e(),a("div",{staticClass:"card-row"},[a("span",{staticClass:"card-row-header"},[t._v("设备地址: ")]),t._v(t._s(e.addr)+" ")]),t.isShow("project")?a("div",{staticClass:"card-row"},[a("span",{staticClass:"card-row-header"},[t._v("所属项目: ")]),t._v(t._s(t.formatRow(e,{property:"project"}))+" ")]):t._e(),t.isShow("product")?a("div",{staticClass:"card-row"},[a("span",{staticClass:"card-row-header"},[t._v("所属产品: ")]),t._v(t._s(e.product.name)+" ")]):t._e(),t.isShow("createTime")?a("div",{staticClass:"card-row"},[a("span",{staticClass:"card-row-header"},[t._v("创建时间: ")]),t._v(t._s(t.parseTime(e.createTime))+" ")]):t._e()]),a("el-aside",{staticStyle:{width:"80px","background-color":"unset",padding:"0px"}},[e.product&&e.product.img?a("ImagePreview",{attrs:{src:e.product.img}}):t._e()],1)],1),a("div",t._l(t.buttons,(function(n){return a("el-button",{key:n.event,attrs:{type:"text",icon:n.icon,"v-hasPermi":n.permission},on:{click:function(a){return t.handleClick(n.event,e)}}},[t._v(t._s(n.text))])})),1)],1)],1)})),1):a("el-table",{attrs:{data:t.tableList},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t.isShow("subAddr")?a("el-table-column",{key:"subAddr",attrs:{label:"从站地址",prop:"subAddr",align:"center"}}):t._e(),a("el-table-column",{key:"name",attrs:{label:"设备名称",prop:"name",align:"center"}}),a("el-table-column",{key:"addr",attrs:{label:"设备地址",prop:"addr",align:"center"}}),t.isShow("netType")?a("el-table-column",{attrs:{label:"连网类型",align:"center",prop:"netType"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("dict-tag",{attrs:{options:t.dict.type.iot_net_type,value:e.row.product.netType}})]}}],null,!1,3527849428)}):t._e(),t.isShow("project")?a("el-table-column",{attrs:{label:"所属项目",align:"center",prop:"project",formatter:t.formatRow}}):t._e(),t.isShow("product")?a("el-table-column",{attrs:{label:"所属产品",align:"center",prop:"product"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.product.name))]}}],null,!1,1879660959)}):t._e(),t.isShow("nodeType")?a("el-table-column",{attrs:{label:"设备类型",align:"center",prop:"nodeType"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("dict-tag",{attrs:{options:t.dict.type.iot_node_type,value:e.row.product.nodeType}})]}}],null,!1,3699797204)}):t._e(),t.isShow("status")?a("el-table-column",{attrs:{label:"是否启用",align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-switch",{attrs:{"active-value":"0","inactive-value":"1"},on:{change:function(a){return t.handleStatusChange(e.row)}},model:{value:e.row.status,callback:function(a){t.$set(e.row,"status",a)},expression:"scope.row.status"}})]}}],null,!1,3955094654)}):t._e(),t.isShow("online")?a("el-table-column",{key:"online",attrs:{label:"在线状态",prop:"online",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return["ezviz"===e.row.product.category?a("div",[t._v("-")]):a("div",[e.row.lastOnline?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"上线时间："+t.parseTime(e.row.lastOnline),placement:"bottom"}},[a("dict-tag",{attrs:{options:t.dict.type.iot_device_status,value:e.row.online}})],1):a("dict-tag",{attrs:{options:t.dict.type.iot_device_status,value:e.row.online}})],1)]}}],null,!1,3260477523)}):t._e(),t.isShow("createTime")?a("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t.parseTime(e.row.createTime)))])]}}],null,!1,3078210614)}):t._e(),t.buttons.length>0?a("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.buttons,(function(n){return a("el-button",{key:n.event,attrs:{type:"text",icon:n.icon,"v-hasPermi":n.permission},on:{click:function(a){return t.handleClick(n.event,e.row)}}},[t._v(t._s(n.text))])}))}}],null,!1,49746620)}):t._e()],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],staticStyle:{"margin-bottom":"25px"},attrs:{total:t.total,page:t.queryParams.pageNum,limit:t.queryParams.pageSize},on:{"update:page":function(e){return t.$set(t.queryParams,"pageNum",e)},"update:limit":function(e){return t.$set(t.queryParams,"pageSize",e)},pagination:t.getList}})],1):a("el-empty",{attrs:{description:"暂无设备"}})],1):t._e()},i=[],s=(a("4de4"),a("d3b7"),a("b64b"),a("e9c4"),a("caad"),a("2532"),a("d81d"),a("a15b"),a("5a98")),o={dicts:["sys_normal_disable","iot_node_type","iot_device_status","iot_net_type"],components:{},props:{showType:{type:String,default:"card"},columns:{type:Array,default:function(){return[{key:"product",label:"所属产品",visible:!0},{key:"project",label:"所属项目",visible:!0},{key:"nodeType",label:"设备类型",visible:!0},{key:"netType",label:"协议类型",visible:!0},{key:"online",label:"在线状态",visible:!0},{key:"status",label:"是否启用",visible:!0},{key:"createTime",label:"创建时间",visible:!0}]}},refresh:{type:Boolean,default:!1},buttons:{type:Array,default:function(){return[]}},queryParams:{type:Object,default:function(){}},size:{type:Array,default:function(){return[24,12,8,8,6]}}},data:function(){return{loading:!1,table:"device",projects:[],total:0,tableList:[],selection:[]}},created:function(){this.getList()},methods:{isShow:function(t){var e=this.columns.filter((function(e){return e.key===t}));return e.length>0&&e[0].visible},getList:function(){if(this.queryParams){this.loading=!0;var t=this,e=JSON.parse(JSON.stringify(this.queryParams));e.pageNum=e.pageNum?e.pageNum:1,e.pageSize=e.pageSize?e.pageSize:10,e.gateway?(this.columns.includes("subAddr")||this.columns.push({key:"subAddr",label:"从站地址",visible:!0}),Object(s["d"])(e).then((function(e){var a=e.rows;t.formatTableList(t,e.total,a)}))):e.scene?Object(s["i"])(e).then((function(e){var a=e.rows;t.formatTableList(t,e.total,a)})):Object(s["k"])(this.table,e).then((function(e){var a=e.rows;t.formatTableList(t,e.total,a)}))}else this.tableList=[]},formatTableList:function(t,e,a){t.updateTableList(a,(function(n,i){a.map((function(t){var e=n.filter((function(e){return e.addr===t.addr})),a=i.filter((function(e){return e.id===t.product}));e&&e.length>0&&1===e[0].online?(t.online=1,t.lastOnline=e[0].connectTime):t.online=0,t.product=a&&a.length>0?a[0]:{}})),t.total=e,t.tableList=a,t.loading=!1}))},queryRelation:function(t,e,a){var n=[];e.length>0?Object(s["g"])(t,e.join(",")).then((function(t){var e=t.data;Array.isArray(e)?n=e:n.push(e),a(n)})).catch((function(t){a([])})):a(n)},updateTableList:function(t,e){var a=this,n=[],i=[],o=[];t.map((function(t){i.push(t.addr),t.product&&!n.includes(t.product)&&n.push(t.product),t.project&&!o.includes(t.project)&&o.push(t.project)})),Object(s["j"])(i.join(",")).then((function(t){var i=t.data;a.queryRelation("product",n,(function(t){a.queryRelation("project",o,(function(n){a.projects=n,e(i,t)}))}))}))},handleCardSelectionChange:function(t,e){t?this.selection.push(e):this.selection=this.selection.filter((function(t){return t.id!==e.id})),this.handleSelectionChange(this.selection),console.log(this.selection)},handleSelectionChange:function(t){var e={selection:t,tableList:this.tableList};this.$emit("handleSelectionChange",e)},handleStatusChange:function(t){return Object(s["l"])(this.table,{id:t.id,status:t.status})},handleClick:function(t,e){this.$emit("handleEvent",t,e)},formatRow:function(t,e){switch(e.property){case"project":if(t.project){var a=this.projects.filter((function(e){return e.id==t.project}));return a&&a[0]?a[0].title:"ID:"+t.project+" 无效"}return"未关联"}}},watch:{queryParams:function(){this.getList()},refresh:function(){this.getList()}}},r=o,l=(a("8050"),a("2877")),c=Object(l["a"])(r,n,i,!1,null,"37ee11c4",null);e["default"]=c.exports}}]);