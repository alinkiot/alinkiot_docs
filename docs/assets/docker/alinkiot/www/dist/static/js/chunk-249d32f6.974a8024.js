(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-249d32f6","chunk-f3d6cca6","chunk-02f71bbf"],{"01f2":function(e,t,i){},1866:function(e,t,i){"use strict";i("01f2")},6137:function(e,t,i){},8050:function(e,t,i){"use strict";i("6137")},"8d71":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e.edit?i("el-row",{staticClass:"mb8",attrs:{gutter:10}},[i("el-col",{attrs:{span:1.5}},[i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["system:device:add"],expression:"['system:device:add']"}],attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:e.handleDevAdd}},[e._v("关联设备")])],1),i("el-col",{attrs:{span:1.5}},[i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["system:device:remove"],expression:"['system:device:remove']"}],attrs:{type:"danger",icon:"el-icon-delete",size:"mini",disabled:e.multiple},on:{click:e.handleDevDelete}},[e._v("解绑设备")])],1),i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{type:"primary",icon:"el-icon-question",size:"mini"},on:{click:e.handleSub}},[e._v("数据订阅")])],1)],1):e._e(),i("DeviceTable",{attrs:{size:e.size,buttons:e.buttons,queryParams:e.queryParams},on:{handleEvent:e.handleEvent,handleSelectionChange:e.handleSelectionChange}}),i("el-dialog",{attrs:{title:"关联设备",visible:e.openDevSelector},on:{"update:visible":function(t){e.openDevSelector=t}}},[i("TableSelect",{attrs:{table:"device",column:e.devColumn},on:{selectDone:e.selectDeviceDone}})],1),i("el-dialog",{attrs:{title:"数据订阅/发布",visible:e.openDoc},on:{"update:visible":function(t){e.openDoc=t}}},[i("TopicBoard",{attrs:{project:e.scene.project,scene:e.scene.id}})],1)],1)},n=[],s=(i("a15b"),i("d81d"),i("5a98")),o=i("6802"),c=i("e412"),l=i("91e5"),r={dicts:["sys_normal_disable"],components:{DeviceTable:l["default"],TableSelect:o["a"],TopicBoard:c["default"]},props:{scene:{type:Object,required:!0},edit:{type:Boolean,default:!1},size:{type:Array,default:function(){return[24,12,8,8,6]}}},data:function(){return{openDoc:!1,openDevSelector:!1,devColumn:[],tableList:[],single:!0,multiple:!0,ids:[],total:0,queryParams:void 0,buttons:[{text:"实时状态",event:"showStatus",icon:"el-icon-view"}]}},created:function(){this.devColumn=[{label:"设备地址",key:"addr",isSearch:!0,regx:!0},{label:"设备名称",key:"name",isSearch:!0,regx:!0},{label:"创建时间",key:"createTime"}],this.getDevList()},methods:{getDevList:function(){this.scene&&this.scene.id&&(this.queryParams={pageNum:1,pageSize:10},this.queryParams.scene=this.scene.id,this.queryParams["orderby[desc]"]="createTime")},handleDevAdd:function(){this.subDevice={addr:void 0,subAddr:void 0},this.openDevSelector=!0},handleDevDelete:function(){var e=this;Object(s["b"])("scene_device",this.ids.join(",")).then((function(t){e.$modal.msgSuccess("解绑成功"),e.getDevList()}))},handleSub:function(){this.openDoc=!0},handleEvent:function(e,t){"showStatus"===e&&this.$emit("click",t.id)},handleSelectionChange:function(e){var t=e.selection;this.ids=t.map((function(e){return e.route})),this.single=1!==t.length,this.multiple=!t.length,this.tableList=e.tableList},selectDeviceDone:function(e){var t=this,i={id:e.id,project:this.scene.project};Object(s["l"])("device",i).then((function(i){var a={device:e.id,scene:t.scene.id};Object(s["a"])("scene_device",a).then((function(e){t.openDevSelector=!1,t.getDevList(),t.$modal.msgSuccess("绑定成功")}))}))}},watch:{scene:function(){this.getDevList()}}},d=r,u=i("2877"),p=Object(u["a"])(d,a,n,!1,null,null,null);t["default"]=p.exports},"91e5":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.queryParams?i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e.tableList.length>0?i("div",["card"===e.showType?i("el-row",{attrs:{gutter:10}},e._l(e.tableList,(function(t){return i("el-col",{key:t.addr,staticStyle:{"margin-bottom":"10px"},attrs:{xs:e.size[0],sm:e.size[1],md:e.size[2],lg:e.size[3],xl:e.size[4]}},[i("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",[i("el-checkbox",{on:{change:function(i){return e.handleCardSelectionChange(i,t)}}}),i("el-button",{staticClass:"card-title",attrs:{type:"text"}},[e._v(e._s(t.name))])],1),i("div",{staticStyle:{float:"right"}},[e.isShow("netType")?i("dict-tag",{attrs:{options:e.dict.type.iot_net_type,value:t.product.netType}}):e._e()],1)]),i("el-container",[i("el-main",{staticStyle:{padding:"0px"}},[i("div",{staticClass:"card-row"},[e.isShow("nodeType")?i("dict-tag",{attrs:{options:e.dict.type.iot_node_type,value:t.product.nodeType}}):e._e(),"ezviz"!==t.product.category?i("span",[t.lastOnline?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"上线时间："+e.parseTime(t.lastOnline),placement:"bottom"}},[i("dict-tag",{attrs:{options:e.dict.type.iot_device_status,value:t.online}})],1):i("dict-tag",{attrs:{options:e.dict.type.iot_device_status,value:t.online}})],1):e._e(),e.isShow("status")&&"1"===t.status?i("el-tag",{attrs:{type:"danger"}},[e._v("禁用")]):e._e()],1),e.isShow("subAddr")?i("div",{staticClass:"card-row"},[i("span",{staticClass:"card-row-header"},[e._v("从站地址: ")]),e._v(e._s(t.subAddr)+" ")]):e._e(),i("div",{staticClass:"card-row"},[i("span",{staticClass:"card-row-header"},[e._v("设备地址: ")]),e._v(e._s(t.addr)+" ")]),e.isShow("project")?i("div",{staticClass:"card-row"},[i("span",{staticClass:"card-row-header"},[e._v("所属项目: ")]),e._v(e._s(e.formatRow(t,{property:"project"}))+" ")]):e._e(),e.isShow("product")?i("div",{staticClass:"card-row"},[i("span",{staticClass:"card-row-header"},[e._v("所属产品: ")]),e._v(e._s(t.product.name)+" ")]):e._e(),e.isShow("createTime")?i("div",{staticClass:"card-row"},[i("span",{staticClass:"card-row-header"},[e._v("创建时间: ")]),e._v(e._s(e.parseTime(t.createTime))+" ")]):e._e()]),i("el-aside",{staticStyle:{width:"80px","background-color":"unset",padding:"0px"}},[t.product&&t.product.img?i("ImagePreview",{attrs:{src:t.product.img}}):e._e()],1)],1),i("div",e._l(e.buttons,(function(a){return i("el-button",{key:a.event,attrs:{type:"text",icon:a.icon,"v-hasPermi":a.permission},on:{click:function(i){return e.handleClick(a.event,t)}}},[e._v(e._s(a.text))])})),1)],1)],1)})),1):i("el-table",{attrs:{data:e.tableList},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),e.isShow("subAddr")?i("el-table-column",{key:"subAddr",attrs:{label:"从站地址",prop:"subAddr",align:"center"}}):e._e(),i("el-table-column",{key:"name",attrs:{label:"设备名称",prop:"name",align:"center"}}),i("el-table-column",{key:"addr",attrs:{label:"设备地址",prop:"addr",align:"center"}}),e.isShow("netType")?i("el-table-column",{attrs:{label:"连网类型",align:"center",prop:"netType"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("dict-tag",{attrs:{options:e.dict.type.iot_net_type,value:t.row.product.netType}})]}}],null,!1,3527849428)}):e._e(),e.isShow("project")?i("el-table-column",{attrs:{label:"所属项目",align:"center",prop:"project",formatter:e.formatRow}}):e._e(),e.isShow("product")?i("el-table-column",{attrs:{label:"所属产品",align:"center",prop:"product"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.product.name))]}}],null,!1,1879660959)}):e._e(),e.isShow("nodeType")?i("el-table-column",{attrs:{label:"设备类型",align:"center",prop:"nodeType"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("dict-tag",{attrs:{options:e.dict.type.iot_node_type,value:t.row.product.nodeType}})]}}],null,!1,3699797204)}):e._e(),e.isShow("status")?i("el-table-column",{attrs:{label:"是否启用",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-switch",{attrs:{"active-value":"0","inactive-value":"1"},on:{change:function(i){return e.handleStatusChange(t.row)}},model:{value:t.row.status,callback:function(i){e.$set(t.row,"status",i)},expression:"scope.row.status"}})]}}],null,!1,3955094654)}):e._e(),e.isShow("online")?i("el-table-column",{key:"online",attrs:{label:"在线状态",prop:"online",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["ezviz"===t.row.product.category?i("div",[e._v("-")]):i("div",[t.row.lastOnline?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"上线时间："+e.parseTime(t.row.lastOnline),placement:"bottom"}},[i("dict-tag",{attrs:{options:e.dict.type.iot_device_status,value:t.row.online}})],1):i("dict-tag",{attrs:{options:e.dict.type.iot_device_status,value:t.row.online}})],1)]}}],null,!1,3260477523)}):e._e(),e.isShow("createTime")?i("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}],null,!1,3078210614)}):e._e(),e.buttons.length>0?i("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(e.buttons,(function(a){return i("el-button",{key:a.event,attrs:{type:"text",icon:a.icon,"v-hasPermi":a.permission},on:{click:function(i){return e.handleClick(a.event,t.row)}}},[e._v(e._s(a.text))])}))}}],null,!1,49746620)}):e._e()],1),i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],staticStyle:{"margin-bottom":"25px"},attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1):i("el-empty",{attrs:{description:"暂无设备"}})],1):e._e()},n=[],s=(i("4de4"),i("d3b7"),i("b64b"),i("e9c4"),i("caad"),i("2532"),i("d81d"),i("a15b"),i("5a98")),o={dicts:["sys_normal_disable","iot_node_type","iot_device_status","iot_net_type"],components:{},props:{showType:{type:String,default:"card"},columns:{type:Array,default:function(){return[{key:"product",label:"所属产品",visible:!0},{key:"project",label:"所属项目",visible:!0},{key:"nodeType",label:"设备类型",visible:!0},{key:"netType",label:"协议类型",visible:!0},{key:"online",label:"在线状态",visible:!0},{key:"status",label:"是否启用",visible:!0},{key:"createTime",label:"创建时间",visible:!0}]}},refresh:{type:Boolean,default:!1},buttons:{type:Array,default:function(){return[]}},queryParams:{type:Object,default:function(){}},size:{type:Array,default:function(){return[24,12,8,8,6]}}},data:function(){return{loading:!1,table:"device",projects:[],total:0,tableList:[],selection:[]}},created:function(){this.getList()},methods:{isShow:function(e){var t=this.columns.filter((function(t){return t.key===e}));return t.length>0&&t[0].visible},getList:function(){if(this.queryParams){this.loading=!0;var e=this,t=JSON.parse(JSON.stringify(this.queryParams));t.pageNum=t.pageNum?t.pageNum:1,t.pageSize=t.pageSize?t.pageSize:10,t.gateway?(this.columns.includes("subAddr")||this.columns.push({key:"subAddr",label:"从站地址",visible:!0}),Object(s["d"])(t).then((function(t){var i=t.rows;e.formatTableList(e,t.total,i)}))):t.scene?Object(s["i"])(t).then((function(t){var i=t.rows;e.formatTableList(e,t.total,i)})):Object(s["k"])(this.table,t).then((function(t){var i=t.rows;e.formatTableList(e,t.total,i)}))}else this.tableList=[]},formatTableList:function(e,t,i){e.updateTableList(i,(function(a,n){i.map((function(e){var t=a.filter((function(t){return t.addr===e.addr})),i=n.filter((function(t){return t.id===e.product}));t&&t.length>0&&1===t[0].online?(e.online=1,e.lastOnline=t[0].connectTime):e.online=0,e.product=i&&i.length>0?i[0]:{}})),e.total=t,e.tableList=i,e.loading=!1}))},queryRelation:function(e,t,i){var a=[];t.length>0?Object(s["g"])(e,t.join(",")).then((function(e){var t=e.data;Array.isArray(t)?a=t:a.push(t),i(a)})).catch((function(e){i([])})):i(a)},updateTableList:function(e,t){var i=this,a=[],n=[],o=[];e.map((function(e){n.push(e.addr),e.product&&!a.includes(e.product)&&a.push(e.product),e.project&&!o.includes(e.project)&&o.push(e.project)})),Object(s["j"])(n.join(",")).then((function(e){var n=e.data;i.queryRelation("product",a,(function(e){i.queryRelation("project",o,(function(a){i.projects=a,t(n,e)}))}))}))},handleCardSelectionChange:function(e,t){e?this.selection.push(t):this.selection=this.selection.filter((function(e){return e.id!==t.id})),this.handleSelectionChange(this.selection),console.log(this.selection)},handleSelectionChange:function(e){var t={selection:e,tableList:this.tableList};this.$emit("handleSelectionChange",t)},handleStatusChange:function(e){return Object(s["l"])(this.table,{id:e.id,status:e.status})},handleClick:function(e,t){this.$emit("handleEvent",e,t)},formatRow:function(e,t){switch(t.property){case"project":if(e.project){var i=this.projects.filter((function(t){return t.id==e.project}));return i&&i[0]?i[0].title:"ID:"+e.project+" 无效"}return"未关联"}}},watch:{queryParams:function(){this.getList()},refresh:function(){this.getList()}}},c=o,l=(i("8050"),i("2877")),r=Object(l["a"])(c,a,n,!1,null,"37ee11c4",null);t["default"]=r.exports},e412:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[i("el-collapse-item",{attrs:{name:"1"}},[i("template",{slot:"title"},[i("h2",[e._v("MQTT 协议接入")])]),i("div",{staticClass:"box"},[i("h3",[e._v("一机一密")]),e.device.dk&&e.device.ds?i("div",[i("div",[e._v("clientid: uzy_1_"+e._s(e.device.addr))]),i("div",[e._v("username: "+e._s(e.device.dk))]),i("div",[e._v("password: "+e._s(e.device.ds))])]):i("div",[e._v(" 未设置设备key和密钥 ")]),i("h3",[e._v("一型一密")]),e.product.pk&&e.product.ps?i("div",[i("div",[e._v("clientid: uzy_2_"+e._s(e.device.addr))]),i("div",[e._v("username: "+e._s(e.product.pk))]),i("div",[e._v("password: "+e._s(e.product.ps))])]):i("div",[e._v(" 未设置产品key和密钥 ")])])],2),i("el-collapse-item",{attrs:{name:"2"}},[i("template",{slot:"title"},[i("h2",[e._v("TCP 透传接入")])]),i("div",{staticClass:"box"},[i("h3",[e._v("一机一密")]),e.device.dk&&e.device.ds?i("div",[i("div",[e._v("注册报文: reg,1,"+e._s(e.device.addr)+","+e._s(e.device.dk)+","+e._s(e.device.ds)+"\\r\\n")]),i("div",[e._v("心跳: ping\\r\\n")])]):i("div",[e._v(" 未设置设备key和密钥 ")]),i("h3",[e._v("一型一密")]),e.product.ps&&e.product.pk?i("div",[i("div",[e._v("注册报文: reg,2,"+e._s(e.device.addr)+","+e._s(e.product.pk)+","+e._s(e.product.ps)+"\\r\\n")]),i("div",[e._v("心跳: ping\\r\\n")])]):i("div",[e._v(" 未设置产品key和密钥 ")])])],2),i("el-collapse-item",{attrs:{name:"3"}},[i("template",{slot:"title"},[i("h2",[e._v("订阅/发布")])]),i("div",{staticClass:"box"},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tabTopic,stripe:""}},[i("el-table-column",{attrs:{prop:"topic",label:"Topic"}}),i("el-table-column",{attrs:{prop:"action",label:"动作"}}),i("el-table-column",{attrs:{prop:"type",label:"类型"}}),i("el-table-column",{attrs:{prop:"desc",label:"说明"}})],1)],1)],2)],1)],1)},n=[],s=(i("99af"),{components:{},props:{device:{type:Object,default:function(){return{}}},product:{type:Object,default:function(){return{}}}},data:function(){return{activeNames:["1"],tabTopic:[]}},created:function(){this.updateTopic()},methods:{updateTopic:function(){var e=[],t=this.device.addr;this.device||(t="${addr}"),this.project||(this.project="${projectId}"),this.scene||(this.scene="${sceneId}"),e=e.concat([{topic:"d/out/"+t,action:"publish",type:"sys",desc:"设备上报到平台"},{topic:"d/in/"+t,action:"subscribe",type:"sys",desc:"平台下发给设备，设备订阅"},{topic:"p/out/"+t,action:"publish",type:"sys",desc:"平台发布设备上行消息"}]),e=e.concat([{topic:"s/out/"+this.project+"/"+this.scene+"/"+t,action:"publish",type:"sys",desc:"平台发布设备上行消息"},{topic:"p/in",action:"publish",type:"sys",desc:"平台订阅，如设备控制，数据同步"}]),this.tabTopic=e}},watch:{addr:function(){this.updateTopic()},scene:function(){this.updateTopic()},project:function(){this.updateTopic()}}}),o=s,c=(i("1866"),i("2877")),l=Object(c["a"])(o,a,n,!1,null,"07dc7bbc",null);t["default"]=l.exports}}]);