(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7582780c"],{"53dc":function(e,t,a){e.exports=a.p+"static/img/marker.a0c0c038.png"},"6b28":function(e,t,a){},"7daf":function(e,t,a){"use strict";a("6b28")},"87ca":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"amap-wrapper",style:{height:e.height+"px"}},[a("el-amap",{attrs:{vid:"amapScene","amap-manager":e.amapManager,zoom:e.zoom,center:e.center,events:e.events,"map-style":e.styleName,plugin:e.plugins}},e._l(e.markers,(function(t){return a("el-amap-marker",{key:t.device.addr,attrs:{title:t.device.name,position:t.position,extData:t.device,events:e.events}})})),1)],1)},i=[],r=(a("a9e3"),a("ac1f"),a("00b4"),a("d81d"),a("a15b"),a("4de4"),a("d3b7"),a("8f9b")),c=a("5a98"),o=a("870c"),s=new r["AMapManager"],l={components:{},props:{scene:{type:Object,required:!0},height:{type:Number,default:function(){return window.innerHeight}}},computed:{styleName:function(){var e=this.$store.state.settings.sideTheme;return/theme-dark-.+/.test(e)?"amap://styles/blue":"amap://styles/normal"}},data:function(){var e=this;return{amapManager:s,plugins:["ToolBar","Autocomplete","OverView","Geocoder"],loading:!1,tableList:[],queryParams:{pageNum:1,pageSize:1e3},markers:[],zoom:13,center:[121.59996,31.197646],defMarkerIcon:a("53dc"),events:{click:function(t){if("AMap.Marker"===t.target["CLASS_NAME"]){var a=t.target.w.extData;e.$emit("click",a.id)}},complete:function(t){e.getDevice((function(t){e.tabList=t;var a=0,n=0,i=0,r=0;t.map((function(t){t.lng>0&&t.lat>0&&(a=0===a?t.lng:Math.min(a,t.lng),i=0===i?t.lat:Math.min(i,t.lat),n=Math.max(n,t.lng),r=Math.max(r,t.lat),e.markers.push({position:[t.lng,t.lat],device:t}))}));var c=e.getZoom(n,a,r,i);c&&(e.center=c.center,e.zoom=c.zoom),e.loading=!1}))}}}},created:function(){Object(o["e"])(this)},methods:{getDevice:function(e){this.loading=!0,this.queryParams.scene=this.scene.id,this.queryParams["orderby[desc]"]="createTime",Object(c["k"])("scene_device",this.queryParams).then((function(t){var a=t.rows,n=[];a.map((function(e){n.push(e.device)}));var i=[];n.length>0?Object(c["g"])("device",n.join(",")).then((function(t){var n=[];Array.isArray(t.data)?n=t.data:n.push(t.data),a.map((function(e){var t=n.filter((function(t){return t.id===e.device}));if(t.length>0){var a=t[0];a.scene=e,i.push(a)}})),e(i)})):e([])}))},getZoom:function(e,t,a,n){if(0!==e&&0!==t&&0!==a&&0!==n){var i=s.getMap(),r=i.getSize(),c=AMap.GeometryUtil.distance([e,a],[t,n]),o=Math.sqrt(r.width*r.width+r.height*r.height),l=c/o,m=16-Math.ceil(Math.log(l)/Math.log(2)),u=[(e+t)/2,(a+n)/2];return{zoom:m,center:u}}}}},m=l,u=(a("7daf"),a("2877")),d=Object(u["a"])(m,n,i,!1,null,"96162444",null);t["default"]=d.exports}}]);