(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2f13dcf2"],{"19c8":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",[t.readonly?t.isEmpty?a("el-tag",{attrs:{type:"info"}},[t._v("未设置")]):a("p",[t._v(" "+t._s(t.location)+" "),a("el-button",{attrs:{type:"text"},on:{click:t.handleSelect}},[a("i",{staticClass:"el-icon-position el-icon--right"})])],1):a("p",[t.isEmpty?[t._v("设置")]:[t._v(t._s(t.data.location))],a("el-button",{attrs:{type:"text"},on:{click:t.handleSelect}},[a("i",{staticClass:"el-icon-edit el-icon--right"})])],2),a("el-dialog",{staticClass:"mapDialog",attrs:{title:t.readonly?"查看位置":"选择位置",visible:t.openSelector,"append-to-body":""},on:{"update:visible":function(e){t.openSelector=e}}},[t.readonly?""!==t.data.location?a("div",[a("h3",[a("i",{staticClass:"el-icon-position"}),t._v(t._s(t.data.location))])]):a("h3",[t._v("未设置")]):a("el-input",{attrs:{placeholder:"请输入设备位置"},model:{value:t.data.location,callback:function(e){t.$set(t.data,"location",e)},expression:"data.location"}},[a("el-button",{attrs:{slot:"append",type:"primary"},on:{click:t.selectDone},slot:"append"},[t._v("确定")])],1),a("div",{staticStyle:{margin:"10px 0px 10px 0px"}},[a("el-tag",[t._v("纬度:"+t._s(t.data.lat))]),a("el-tag",{staticStyle:{"margin-left":"10px"}},[t._v("经度:"+t._s(t.data.lng))])],1),a("div",{staticClass:"amap-wrapper"},[t.readonly?t._e():a("el-amap-search-box",{staticClass:"amap-search-box",attrs:{"search-option":t.searchOption,"on-search-result":t.onSearchResult}}),a("el-amap",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{vid:"amapDev",zoom:t.zoom,"map-style":t.styleName,center:t.center,plugin:t.plugins,"amap-manager":t.amapManager,events:t.events}})],1)],1)],1)},i=[],l=(a("a9e3"),a("ac1f"),a("00b4"),a("b0c0"),a("8f9b")),o=a("870c"),r=new l["AMapManager"],s={components:{},props:{name:{type:String,default:void 0},location:{type:String,default:void 0},lat:{type:Number,default:void 0},lng:{type:Number,default:void 0},readonly:{type:Boolean,default:!1}},computed:{styleName:function(){var t=this.$store.state.settings.sideTheme;return/theme-dark-.+/.test(t)?"amap://styles/blue":"amap://styles/normal"}},data:function(){var t=this;return{loading:!1,title:"",data:{location:void 0,lat:void 0,lng:void 0},isEmpty:!0,amapManager:r,plugins:["ToolBar","Autocomplete","OverView","Geocoder"],zoom:15,center:[121.59996,31.197646],openSelector:!1,searchOption:{city:"",citylimit:!1},events:{complete:function(e){t.data.lat&&t.data.lng&&t.setMarker(t.data)},click:function(e){t.loading=!0,t.data.lat=e.lnglat.lat,t.data.lng=e.lnglat.lng,t.setMarker(e.lnglat);var a=new AMap.Geocoder({});a.getAddress(e.lnglat,(function(e,a){t.loading=!1,"complete"===e&&a.regeocode&&(t.data.country=a.regeocode.addressComponent.country,t.data.province=a.regeocode.addressComponent.province,t.data.district=a.regeocode.addressComponent.district,t.data.location=a.regeocode.formattedAddress,t.setEmpty())}))}}}},created:function(){this.data={location:this.location,lng:this.lng,lat:this.lat},this.setEmpty(),Object(o["e"])(this)},methods:{setEmpty:function(){this.isEmpty=void 0===this.data.location||""===this.data.location},setMarker:function(t){t.Q=t.lat,t.R=t.lng;var e=r.getMap();this.marker&&(e.remove(this.marker),e.setFitView()),this.marker=new AMap.Marker({map:e}),this.center=[t.lng,t.lat],this.marker.setPosition(t)},selectDone:function(){var t=this.data;t.name=this.name,this.$emit("selectDone",t),this.openSelector=!1},handleSelect:function(){this.openSelector=!0},onSearchResult:function(t){if(t.length>0){var e=t[0];this.center=[e.lng,e.lat],this.data.location=e.address,this.data.lat=e.lat,this.data.lng=e.lng}}},watch:{readonly:function(){this.title=this.readonly?"查看位置":"选择位置"},location:function(){this.data={location:this.location,lat:this.lat?this.lat:"-",lng:this.lng?this.lng:"-"},this.setEmpty()}}},c=s,d=(a("2bab"),a("2877")),u=Object(d["a"])(c,n,i,!1,null,"2eae3cf5",null);e["a"]=u.exports},"2bab":function(t,e,a){"use strict";a("c0e8")},"34cf":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[t.buttons.length>0||t.title?a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t.title?a("span",{staticStyle:{"font-weight":"bold","line-height":"40px"}},[t._v(t._s(t.title))]):t._e(),a("el-button-group",{staticStyle:{float:"right",padding:"3px 0"}},t._l(t.buttons,(function(e){return a("el-button",{key:e.key,class:e.icon,staticStyle:{"margin-right":"5px"},attrs:{type:"text"},on:{click:function(a){return t.doClick(e)}}},[t._v(t._s(e.title))])})),1)],1):t._e(),t.columns.length>0?a("el-row",{staticClass:"tab-body"},t._l(t.columns,(function(e){return a("el-col",{key:e.key,staticClass:"tab-col",attrs:{xs:24,sm:12,md:8,lg:8,xl:6}},[a("div",{staticClass:"td-title"},[t._v(t._s(e.title))]),a("div",{staticClass:"td-value"},["map"===e.type?[a("MapSelector",{attrs:{name:e.key,location:t.getValue(e),lat:t.getLngLat("lat",e),lng:t.getLngLat("lng",e)},on:{selectDone:t.selectMapDone}})]:"dict"===e.type?[a("dict-tag",{attrs:{options:e.options,value:t.getValue(e)}})]:t.checkEmpty(e)?[t._v("--")]:["href"===e.type?[a("el-link",{attrs:{type:"primary","underline:":"true",href:t.getValue(e),target:"_blank"}},[t._v("访问")])]:"image"===e.type?[a("ImagePreview",{staticStyle:{width:"20px"},attrs:{src:t.getValue(e)}})]:"secret"===e.type?[a("span",{staticClass:"secret-box"},[t._v("******")]),a("el-popover",{attrs:{placement:"bottom",title:e.title+":",width:"200",trigger:"click",content:t.getValue(e)}},[a("el-button",{attrs:{slot:"reference",type:"text",icon:"el-icon-view"},slot:"reference"})],1)]:[t._v(" "+t._s(t.getValue(e))+" ")]],e.click?a("el-button",{attrs:{type:"text",icon:e.click.icon,circle:""},on:{click:function(a){return t.doClick(e)}}},[e.click.title?[t._v(" "+t._s(e.click.title)+" ")]:t._e()],2):t._e()],2)])})),1):a("el-empty",{attrs:{description:"暂无"+t.title}})],1)},i=[],l=(a("b0c0"),a("4de4"),a("d3b7"),a("a15b"),a("5a0c")),o=a.n(l),r=a("9a2d"),s=a("19c8"),c={components:{MapSelector:s["a"],ImagePreview:r["a"]},props:{title:{type:String,default:void 0},columns:{type:Array,default:function(){return[]}},item:{type:Object,default:function(){return{}}},buttons:{type:Array,default:function(){return[]}}},data:function(){return{}},created:function(){},methods:{checkEmpty:function(t){var e=this.getValue(t);return null===e||void 0===e||""===e},doClick:function(t){this.$emit("click",t)},selectMapDone:function(t){var e=t.name,a=this.columns.filter((function(t){return t.key===e}));if(a.length>0){var n=a[0];this.$emit("selectMapDone",n,t)}},getLngLat:function(t,e){var a=e[t];return this.item[a]},getValue:function(t){var e=t.key,a=t.format,n=this.item[e];if("relation"===t.type){var i=t.on,l=this.item[i];return a?a(e,{field:l,key:n}):l||n?(l=l||"--",n=n||"--",[n,l].join(",")):void 0}return"datetime"===t.type?n?o()(1e3*n).format("YYYY-MM-DD HH:mm:ss"):void 0:a?a(e,n):n}}},d=c,u=(a("d8ff"),a("2877")),p=Object(u["a"])(d,n,i,!1,null,"111fd298",null);e["a"]=p.exports},"452d":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("TableShow",{attrs:{title:"扩展字段",columns:t.columns,item:t.extend,buttons:t.buttons},on:{click:t.itemClick}}),a("el-dialog",{attrs:{title:"扩展字段",visible:t.open},on:{"update:visible":function(e){t.open=e}}},[a("el-form",{ref:"cfgForm",attrs:{rules:t.cfgFormRule,model:t.form,"label-position":"top",prop:"cfgForm"}},[a("el-form-item",{attrs:{label:"字段名称",prop:"title"}},[a("el-input",{attrs:{placeholder:"请输入字段名称"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),t.isCreate?[a("el-form-item",{attrs:{label:"字段标识",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入字段标识"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:"数据类型",prop:"type"}},[a("el-select",{attrs:{placeholder:"数据类型"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type","string"===typeof e?e.trim():e)},expression:"form.type"}},t._l(t.dict.type.iot_data_type,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)]:t._e(),a("el-form-item",{attrs:{label:"数据值",prop:"value"}},["integer"===t.form.type?a("el-input",{attrs:{placeholder:"请输入数值"},model:{value:t.form.value,callback:function(e){t.$set(t.form,"value",t._n(e))},expression:"form.value"}}):a("el-input",{attrs:{placeholder:"请输入数据内容"},model:{value:t.form.value,callback:function(e){t.$set(t.form,"value",e)},expression:"form.value"}})],1),a("el-form-item",[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.addExtendDone}},[t._v("确定")]),t.isCreate?t._e():a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:t.delExtend}},[t._v("删除")])],1)],2)],1)],1)},i=[],l=(a("a9e3"),a("d81d"),a("b0c0"),a("4de4"),a("d3b7"),a("b64b"),a("e9c4"),a("5a98")),o=a("34cf"),r={dicts:["iot_data_type"],components:{TableShow:o["a"]},props:{id:{type:[Number,String],required:!0},table:{type:String}},data:function(){return{open:!1,form:{},extendTable:[],isCreate:!0,columns:[],extend:{},buttons:[{icon:"el-icon-plus",key:"addExtend",title:"新增"},{icon:"el-icon-delete",key:"cleanAll",title:"清空"}],cfgFormRule:{type:[{required:!0,message:"数据类型不能为空",trigger:"blur"}],name:[{required:!0,message:"字段标识不能为空",trigger:"blur"}],title:[{required:!0,message:"字段名称不能为空",trigger:"blur"}]}}},created:function(){this.getExtend()},methods:{createData:function(){var t=this;this.columns=[],this.extendTable.map((function(e){t.extend[e.name]=e.value;var a={key:e.name,title:e.title,type:"text",click:{icon:"el-icon-edit-outline"}};e.default&&(a.title=e.title),t.columns.push(a)}))},itemClick:function(t){if("addExtend"===t.key)this.isCreate=!0,this.form={},this.open=!0;else if("cleanAll"===t.key)this.delAll();else{this.isCreate=!1;var e=this.extendTable.filter((function(e){return e.name===t.key}));e.length>0&&(this.form=e[0],this.open=!0)}},getExtend:function(t){var e=this;Object(l["g"])(this.table,this.id).then((function(a){var n=a.data,i=n.config?JSON.parse(n.config):[];"device"===e.table&&n.product?Object(l["g"])("product",n.product).then((function(a){var n=a.data.config?JSON.parse(a.data.config):[];n.map((function(t){var e=i.filter((function(e){return e.name===t.name}));0===e.length&&(t.default=!0,i.push(t))})),e.extendTable=i,e.createData(),t&&t()})):(e.extendTable=i,e.createData(),t&&t())}))},delAll:function(){var t=this,e={id:this.id,config:JSON.stringify([])},a=this;Object(l["l"])(this.table,e).then((function(e){t.getExtend((function(){a.open=!1}))}))},delExtend:function(){var t=this,e=this.form.name,a=this.extendTable.filter((function(t){return!t.default&&t.name!==e})),n={id:this.id,config:JSON.stringify(a)},i=this;Object(l["l"])(this.table,n).then((function(e){t.getExtend((function(){i.open=!1}))}))},addExtendDone:function(){var t=this;this.$refs["cfgForm"].validate((function(e){if(e){var a=t.form.value;"float"===t.form.type&&(a=parseFloat(a));var n={title:t.form.title,name:t.form.name,type:t.form.type,value:a},i=[],o=!0;t.extendTable.map((function(e){e.name===t.form.name?(o=!1,i.push(n)):i.push(e)})),o&&i.push(n);var r={id:t.id,config:JSON.stringify(i)};Object(l["l"])(t.table,r).then((function(e){t.open=!1,t.extendTable=i,t.createData(),t.$modal.msgSuccess(o?"创建成功!":"更新成功!")}))}}))}}},s=r,c=a("2877"),d=Object(c["a"])(s,n,i,!1,null,"75e6d1de",null);e["default"]=d.exports},"9b59":function(t,e,a){},c0e8:function(t,e,a){},d8ff:function(t,e,a){"use strict";a("9b59")}}]);