(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3172aba0","chunk-0fcaf5f4","chunk-f3d6cca6"],{"025a":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.device?e._e():a("el-card",{staticStyle:{"margin-bottom":"10px","border-width":"0px"},attrs:{shadow:"never"}},[a("el-steps",{attrs:{active:2,"align-center":"","finish-status":"success"}},[a("el-step",{attrs:{title:"步骤1",description:"创建产品、定义物模型"}}),a("el-step",{attrs:{title:"步骤2",description:"创建设备，关联产品"}}),a("el-step",{attrs:{title:"步骤3",description:"连接上云、查看实时数据"}})],1)],1),a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"设备地址：",prop:"addr"}},[a("el-input",{attrs:{placeholder:"请输入设备地址"},model:{value:e.form.addr,callback:function(t){e.$set(e.form,"addr",t)},expression:"form.addr"}})],1),a("el-form-item",{attrs:{label:"设备名称：",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入设备名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("InputTableSelect",{attrs:{queryId:e.form.product,showColumn:"name",label:"所属产品 ",table:"product",prop:"product"},on:{selectDone:e.selectProductDone}}),a("br"),a("InputTableSelect",{attrs:{queryId:e.form.project,showColumn:"title",label:"所属项目",table:"project",prop:"project"},on:{selectDone:e.selectProjectDone}}),a("el-form-item",{attrs:{label:"安装位置：",prop:"location"}},[a("MapSelector",{attrs:{location:e.form.location,lat:e.form.lat,lng:e.form.lng},on:{selectDone:e.selectMapDone}})],1),a("el-form-item",{attrs:{label:"禁用状态：",prop:"status"}},[a("el-radio-group",{model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},e._l(e.dict.type.sys_normal_disable,(function(t){return a("el-radio",{key:t.value,attrs:{label:t.value}},[e._v(e._s(t.label)+" ")])})),1)],1),a("el-form-item",[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.submitForm}},[e._v("保存")])],1)],1)],1)],1)},s=[],n=(a("b0c0"),a("84de")),o=a("19c8"),r=a("5a98"),l=a("a6e8"),c={components:{InputTableSelect:n["a"],MapSelector:o["a"]},dicts:["sys_normal_disable"],props:{device:{type:Object,default:function(){}}},data:function(){return{loading:!1,table:"device",form:{status:"0"},product:void 0,project:void 0,rules:{addr:[{required:!0,validator:l["h"],message:"设备地址只能为0-9、a-z、A-Z",trigger:"blur"}],name:[{required:!0,message:"设备名称不能为空",trigger:"blur"}],nodeType:[{required:!0,message:"设备类型不能为空",trigger:"blur"}],product:[{self:this,validator:l["j"],required:!0,message:"所属产品不能为空",trigger:"blur"}]}}},created:function(){this.device&&(this.form={id:this.device.id,addr:this.device.addr,name:this.device.name,product:this.device.product,project:this.device.project,location:this.device.location,lat:this.device.lat,lng:this.device.lng,status:this.device.status})},methods:{reset:function(){this.product=void 0,this.project=void 0,this.form={status:"0"}},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){t&&(e.loading=!0,e.device?Object(r["l"])(e.table,e.form).then((function(t){e.$modal.msgSuccess("修改成功!"),e.loading=!1,e.$emit("onUpdate",e.form)})):Object(r["a"])(e.table,e.form).then((function(t){e.$modal.msgSuccess("新增成功!"),e.loading=!1,e.$emit("onCreate",e.form),e.reset()})))}))},selectMapDone:function(e){this.form.location=e.location,this.form.country=e.country,this.form.province=e.province,this.form.district=e.district,this.form.lat=e.lat,this.form.lng=e.lng},selectProjectDone:function(e){this.project=e,e?this.form.project=this.project.id:(this.form.project=void 0,this.device.project=void 0)},selectProductDone:function(e){this.product=e,e?this.form.product=this.product.id:(this.form.product=void 0,this.device.product=void 0)}}},d=c,u=a("2877"),p=Object(u["a"])(d,i,s,!1,null,"022e5996",null);t["default"]=p.exports},"19c8":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",[e.readonly?e.isEmpty?a("el-tag",{attrs:{type:"info"}},[e._v("未设置")]):a("p",[e._v(" "+e._s(e.location)+" "),a("el-button",{attrs:{type:"text"},on:{click:e.handleSelect}},[a("i",{staticClass:"el-icon-position el-icon--right"})])],1):a("p",[e.isEmpty?[e._v("设置")]:[e._v(e._s(e.data.location))],a("el-button",{attrs:{type:"text"},on:{click:e.handleSelect}},[a("i",{staticClass:"el-icon-edit el-icon--right"})])],2),a("el-dialog",{staticClass:"mapDialog",attrs:{title:e.readonly?"查看位置":"选择位置",visible:e.openSelector,"append-to-body":""},on:{"update:visible":function(t){e.openSelector=t}}},[e.readonly?""!==e.data.location?a("div",[a("h3",[a("i",{staticClass:"el-icon-position"}),e._v(e._s(e.data.location))])]):a("h3",[e._v("未设置")]):a("el-input",{attrs:{placeholder:"请输入设备位置"},model:{value:e.data.location,callback:function(t){e.$set(e.data,"location",t)},expression:"data.location"}},[a("el-button",{attrs:{slot:"append",type:"primary"},on:{click:e.selectDone},slot:"append"},[e._v("确定")])],1),a("div",{staticStyle:{margin:"10px 0px 10px 0px"}},[a("el-tag",[e._v("纬度:"+e._s(e.data.lat))]),a("el-tag",{staticStyle:{"margin-left":"10px"}},[e._v("经度:"+e._s(e.data.lng))])],1),a("div",{staticClass:"amap-wrapper"},[e.readonly?e._e():a("el-amap-search-box",{staticClass:"amap-search-box",attrs:{"search-option":e.searchOption,"on-search-result":e.onSearchResult}}),a("el-amap",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{vid:"amapDev",zoom:e.zoom,"map-style":e.styleName,center:e.center,plugin:e.plugins,"amap-manager":e.amapManager,events:e.events}})],1)],1)],1)},s=[],n=(a("a9e3"),a("ac1f"),a("00b4"),a("b0c0"),a("8f9b")),o=a("870c"),r=new n["AMapManager"],l={components:{},props:{name:{type:String,default:void 0},location:{type:String,default:void 0},lat:{type:Number,default:void 0},lng:{type:Number,default:void 0},readonly:{type:Boolean,default:!1}},computed:{styleName:function(){var e=this.$store.state.settings.sideTheme;return/theme-dark-.+/.test(e)?"amap://styles/blue":"amap://styles/normal"}},data:function(){var e=this;return{loading:!1,title:"",data:{location:void 0,lat:void 0,lng:void 0},isEmpty:!0,amapManager:r,plugins:["ToolBar","Autocomplete","OverView","Geocoder"],zoom:15,center:[121.59996,31.197646],openSelector:!1,searchOption:{city:"",citylimit:!1},events:{complete:function(t){e.data.lat&&e.data.lng&&e.setMarker(e.data)},click:function(t){e.loading=!0,e.data.lat=t.lnglat.lat,e.data.lng=t.lnglat.lng,e.setMarker(t.lnglat);var a=new AMap.Geocoder({});a.getAddress(t.lnglat,(function(t,a){e.loading=!1,"complete"===t&&a.regeocode&&(e.data.country=a.regeocode.addressComponent.country,e.data.province=a.regeocode.addressComponent.province,e.data.district=a.regeocode.addressComponent.district,e.data.location=a.regeocode.formattedAddress,e.setEmpty())}))}}}},created:function(){this.data={location:this.location,lng:this.lng,lat:this.lat},this.setEmpty(),Object(o["e"])(this)},methods:{setEmpty:function(){this.isEmpty=void 0===this.data.location||""===this.data.location},setMarker:function(e){e.Q=e.lat,e.R=e.lng;var t=r.getMap();this.marker&&(t.remove(this.marker),t.setFitView()),this.marker=new AMap.Marker({map:t}),this.center=[e.lng,e.lat],this.marker.setPosition(e)},selectDone:function(){var e=this.data;e.name=this.name,this.$emit("selectDone",e),this.openSelector=!1},handleSelect:function(){this.openSelector=!0},onSearchResult:function(e){if(e.length>0){var t=e[0];this.center=[t.lng,t.lat],this.data.location=t.address,this.data.lat=t.lat,this.data.lng=t.lng}}},watch:{readonly:function(){this.title=this.readonly?"查看位置":"选择位置"},location:function(){this.data={location:this.location,lat:this.lat?this.lat:"-",lng:this.lng?this.lng:"-"},this.setEmpty()}}},c=l,d=(a("2bab"),a("2877")),u=Object(d["a"])(c,i,s,!1,null,"2eae3cf5",null);t["a"]=u.exports},"2bab":function(e,t,a){"use strict";a("c0e8")},6137:function(e,t,a){},8050:function(e,t,a){"use strict";a("6137")},"91e5":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.queryParams?a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e.tableList.length>0?a("div",["card"===e.showType?a("el-row",{attrs:{gutter:10}},e._l(e.tableList,(function(t){return a("el-col",{key:t.addr,staticStyle:{"margin-bottom":"10px"},attrs:{xs:e.size[0],sm:e.size[1],md:e.size[2],lg:e.size[3],xl:e.size[4]}},[a("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[a("el-checkbox",{on:{change:function(a){return e.handleCardSelectionChange(a,t)}}}),a("el-button",{staticClass:"card-title",attrs:{type:"text"}},[e._v(e._s(t.name))])],1),a("div",{staticStyle:{float:"right"}},[e.isShow("netType")?a("dict-tag",{attrs:{options:e.dict.type.iot_net_type,value:t.product.netType}}):e._e()],1)]),a("el-container",[a("el-main",{staticStyle:{padding:"0px"}},[a("div",{staticClass:"card-row"},[e.isShow("nodeType")?a("dict-tag",{attrs:{options:e.dict.type.iot_node_type,value:t.product.nodeType}}):e._e(),"ezviz"!==t.product.category?a("span",[t.lastOnline?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"上线时间："+e.parseTime(t.lastOnline),placement:"bottom"}},[a("dict-tag",{attrs:{options:e.dict.type.iot_device_status,value:t.online}})],1):a("dict-tag",{attrs:{options:e.dict.type.iot_device_status,value:t.online}})],1):e._e(),e.isShow("status")&&"1"===t.status?a("el-tag",{attrs:{type:"danger"}},[e._v("禁用")]):e._e()],1),e.isShow("subAddr")?a("div",{staticClass:"card-row"},[a("span",{staticClass:"card-row-header"},[e._v("从站地址: ")]),e._v(e._s(t.subAddr)+" ")]):e._e(),a("div",{staticClass:"card-row"},[a("span",{staticClass:"card-row-header"},[e._v("设备地址: ")]),e._v(e._s(t.addr)+" ")]),e.isShow("project")?a("div",{staticClass:"card-row"},[a("span",{staticClass:"card-row-header"},[e._v("所属项目: ")]),e._v(e._s(e.formatRow(t,{property:"project"}))+" ")]):e._e(),e.isShow("product")?a("div",{staticClass:"card-row"},[a("span",{staticClass:"card-row-header"},[e._v("所属产品: ")]),e._v(e._s(t.product.name)+" ")]):e._e(),e.isShow("createTime")?a("div",{staticClass:"card-row"},[a("span",{staticClass:"card-row-header"},[e._v("创建时间: ")]),e._v(e._s(e.parseTime(t.createTime))+" ")]):e._e()]),a("el-aside",{staticStyle:{width:"80px","background-color":"unset",padding:"0px"}},[t.product&&t.product.img?a("ImagePreview",{attrs:{src:t.product.img}}):e._e()],1)],1),a("div",e._l(e.buttons,(function(i){return a("el-button",{key:i.event,attrs:{type:"text",icon:i.icon,"v-hasPermi":i.permission},on:{click:function(a){return e.handleClick(i.event,t)}}},[e._v(e._s(i.text))])})),1)],1)],1)})),1):a("el-table",{attrs:{data:e.tableList},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),e.isShow("subAddr")?a("el-table-column",{key:"subAddr",attrs:{label:"从站地址",prop:"subAddr",align:"center"}}):e._e(),a("el-table-column",{key:"name",attrs:{label:"设备名称",prop:"name",align:"center"}}),a("el-table-column",{key:"addr",attrs:{label:"设备地址",prop:"addr",align:"center"}}),e.isShow("netType")?a("el-table-column",{attrs:{label:"连网类型",align:"center",prop:"netType"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("dict-tag",{attrs:{options:e.dict.type.iot_net_type,value:t.row.product.netType}})]}}],null,!1,3527849428)}):e._e(),e.isShow("project")?a("el-table-column",{attrs:{label:"所属项目",align:"center",prop:"project",formatter:e.formatRow}}):e._e(),e.isShow("product")?a("el-table-column",{attrs:{label:"所属产品",align:"center",prop:"product"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.product.name))]}}],null,!1,1879660959)}):e._e(),e.isShow("nodeType")?a("el-table-column",{attrs:{label:"设备类型",align:"center",prop:"nodeType"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("dict-tag",{attrs:{options:e.dict.type.iot_node_type,value:t.row.product.nodeType}})]}}],null,!1,3699797204)}):e._e(),e.isShow("status")?a("el-table-column",{attrs:{label:"是否启用",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":"0","inactive-value":"1"},on:{change:function(a){return e.handleStatusChange(t.row)}},model:{value:t.row.status,callback:function(a){e.$set(t.row,"status",a)},expression:"scope.row.status"}})]}}],null,!1,3955094654)}):e._e(),e.isShow("online")?a("el-table-column",{key:"online",attrs:{label:"在线状态",prop:"online",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["ezviz"===t.row.product.category?a("div",[e._v("-")]):a("div",[t.row.lastOnline?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"上线时间："+e.parseTime(t.row.lastOnline),placement:"bottom"}},[a("dict-tag",{attrs:{options:e.dict.type.iot_device_status,value:t.row.online}})],1):a("dict-tag",{attrs:{options:e.dict.type.iot_device_status,value:t.row.online}})],1)]}}],null,!1,3260477523)}):e._e(),e.isShow("createTime")?a("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}],null,!1,3078210614)}):e._e(),e.buttons.length>0?a("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(e.buttons,(function(i){return a("el-button",{key:i.event,attrs:{type:"text",icon:i.icon,"v-hasPermi":i.permission},on:{click:function(a){return e.handleClick(i.event,t.row)}}},[e._v(e._s(i.text))])}))}}],null,!1,49746620)}):e._e()],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],staticStyle:{"margin-bottom":"25px"},attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1):a("el-empty",{attrs:{description:"暂无设备"}})],1):e._e()},s=[],n=(a("4de4"),a("d3b7"),a("b64b"),a("e9c4"),a("caad"),a("2532"),a("d81d"),a("a15b"),a("5a98")),o={dicts:["sys_normal_disable","iot_node_type","iot_device_status","iot_net_type"],components:{},props:{showType:{type:String,default:"card"},columns:{type:Array,default:function(){return[{key:"product",label:"所属产品",visible:!0},{key:"project",label:"所属项目",visible:!0},{key:"nodeType",label:"设备类型",visible:!0},{key:"netType",label:"协议类型",visible:!0},{key:"online",label:"在线状态",visible:!0},{key:"status",label:"是否启用",visible:!0},{key:"createTime",label:"创建时间",visible:!0}]}},refresh:{type:Boolean,default:!1},buttons:{type:Array,default:function(){return[]}},queryParams:{type:Object,default:function(){}},size:{type:Array,default:function(){return[24,12,8,8,6]}}},data:function(){return{loading:!1,table:"device",projects:[],total:0,tableList:[],selection:[]}},created:function(){this.getList()},methods:{isShow:function(e){var t=this.columns.filter((function(t){return t.key===e}));return t.length>0&&t[0].visible},getList:function(){if(this.queryParams){this.loading=!0;var e=this,t=JSON.parse(JSON.stringify(this.queryParams));t.pageNum=t.pageNum?t.pageNum:1,t.pageSize=t.pageSize?t.pageSize:10,t.gateway?(this.columns.includes("subAddr")||this.columns.push({key:"subAddr",label:"从站地址",visible:!0}),Object(n["d"])(t).then((function(t){var a=t.rows;e.formatTableList(e,t.total,a)}))):t.scene?Object(n["i"])(t).then((function(t){var a=t.rows;e.formatTableList(e,t.total,a)})):Object(n["k"])(this.table,t).then((function(t){var a=t.rows;e.formatTableList(e,t.total,a)}))}else this.tableList=[]},formatTableList:function(e,t,a){e.updateTableList(a,(function(i,s){a.map((function(e){var t=i.filter((function(t){return t.addr===e.addr})),a=s.filter((function(t){return t.id===e.product}));t&&t.length>0&&1===t[0].online?(e.online=1,e.lastOnline=t[0].connectTime):e.online=0,e.product=a&&a.length>0?a[0]:{}})),e.total=t,e.tableList=a,e.loading=!1}))},queryRelation:function(e,t,a){var i=[];t.length>0?Object(n["g"])(e,t.join(",")).then((function(e){var t=e.data;Array.isArray(t)?i=t:i.push(t),a(i)})).catch((function(e){a([])})):a(i)},updateTableList:function(e,t){var a=this,i=[],s=[],o=[];e.map((function(e){s.push(e.addr),e.product&&!i.includes(e.product)&&i.push(e.product),e.project&&!o.includes(e.project)&&o.push(e.project)})),Object(n["j"])(s.join(",")).then((function(e){var s=e.data;a.queryRelation("product",i,(function(e){a.queryRelation("project",o,(function(i){a.projects=i,t(s,e)}))}))}))},handleCardSelectionChange:function(e,t){e?this.selection.push(t):this.selection=this.selection.filter((function(e){return e.id!==t.id})),this.handleSelectionChange(this.selection),console.log(this.selection)},handleSelectionChange:function(e){var t={selection:e,tableList:this.tableList};this.$emit("handleSelectionChange",t)},handleStatusChange:function(e){return Object(n["l"])(this.table,{id:e.id,status:e.status})},handleClick:function(e,t){this.$emit("handleEvent",e,t)},formatRow:function(e,t){switch(t.property){case"project":if(e.project){var a=this.projects.filter((function(t){return t.id==e.project}));return a&&a[0]?a[0].title:"ID:"+e.project+" 无效"}return"未关联"}}},watch:{queryParams:function(){this.getList()},refresh:function(){this.getList()}}},r=o,l=(a("8050"),a("2877")),c=Object(l["a"])(r,i,s,!1,null,"37ee11c4",null);t["default"]=c.exports},c0e8:function(e,t,a){},c572:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,size:"small",inline:!0,"label-width":"82px"}},[a("InputTableSelect",{staticStyle:{display:"inline-block"},attrs:{read:e.isRead("project"),queryId:e.project.id,showColumn:"title",label:"所属项目",table:"project"},on:{selectDone:e.selectProjectDone}}),a("InputTableSelect",{attrs:{showColumn:"name",label:"所属产品",read:e.isRead("product"),queryId:e.product.id,table:"product"},on:{selectDone:e.selectProductDone}}),a("el-form-item",{attrs:{label:"设备类型: ",prop:"nodeType"}},[e.isRead("nodeType")?a("el-select",{attrs:{multiple:"",placeholder:"设备类型",disabled:""},model:{value:e.nodeType,callback:function(t){e.nodeType=t},expression:"nodeType"}},e._l(e.dict.type.iot_node_type,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):a("el-select",{attrs:{multiple:"",placeholder:"设备类型",clearable:""},model:{value:e.nodeType,callback:function(t){e.nodeType=t},expression:"nodeType"}},e._l(e.dict.type.iot_node_type,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("br"),a("el-form-item",[a("el-input",{attrs:{placeholder:"请输入",clearable:""},model:{value:e.queryParams.device,callback:function(t){e.$set(e.queryParams,"device",t)},expression:"queryParams.device"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:e.select,callback:function(t){e.select=t},expression:"select"}},[a("el-option",{attrs:{label:"设备地址",value:"addr"}}),a("el-option",{attrs:{label:"设备名称",value:"name"}})],1)],1)],1),a("el-form-item",{attrs:{label:"禁用状态: ",prop:"status"}},[e.isRead("status")?a("el-select",{attrs:{disabled:"",placeholder:"是否禁用"},model:{value:e.queryParams.status,callback:function(t){e.$set(e.queryParams,"status",t)},expression:"queryParams.status"}},e._l(e.dict.type.sys_normal_disable,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):a("el-select",{attrs:{placeholder:"是否禁用: ",clearable:""},model:{value:e.queryParams.status,callback:function(t){e.$set(e.queryParams,"status",t)},expression:"queryParams.status"}},e._l(e.dict.type.sys_normal_disable,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),a("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),a("el-row",{staticClass:"mb8",attrs:{gutter:10}},[a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["system:device:add"],expression:"['system:device:add']"}],attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:e.handleAdd}},[e._v("新增")])],1),a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["system:device:remove"],expression:"['system:device:remove']"}],attrs:{type:"danger",icon:"el-icon-delete",size:"mini",disabled:e.multiple},on:{click:e.handleDelete}},[e._v("删除")])],1),a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["system:device:kick"],expression:"['system:device:kick']"}],attrs:{type:"info",disabled:e.single,icon:"el-icon-warning-outline",size:"mini"},on:{click:e.handleKick}},[e._v("下线")])],1),a("right-toolbar",{attrs:{component:e.componentPath,menuQuery:e.menuQuery,table:e.table,showSearch:e.showSearch,showType:e.showType,showImport:!0,showDownload:!0},on:{"update:showSearch":function(t){e.showSearch=t},"update:show-search":function(t){e.showSearch=t},"update:showType":function(t){e.showType=t},"update:show-type":function(t){e.showType=t},queryTable:e.getList,download:e.handleExport}})],1),a("DeviceTable",{attrs:{queryParams:e.deviceQuery,buttons:e.buttons,showType:e.showType},on:{handleEvent:e.handleEvent,handleSelectionChange:e.handleSelectionChange}}),a("el-drawer",{attrs:{title:"创建设备",visible:e.open,direction:"rtl",size:"40%"},on:{"update:visible":function(t){e.open=t}}},[a("DeviceForm",{staticStyle:{padding:"10px"},on:{onCreate:e.onCreate}})],1)],1)},s=[],n=a("5530"),o=(a("4de4"),a("d3b7"),a("b64b"),a("e9c4"),a("a15b"),a("d81d"),a("5a98")),r=a("84de"),l=a("870c"),c=a("025a"),d=a("91e5"),u={name:"Device",dicts:["sys_normal_disable","iot_node_type"],components:{InputTableSelect:r["a"],DeviceTable:d["default"],DeviceForm:c["default"]},data:function(){return{table:"device",desc:"设备",ids:[],nodeType:[],single:!0,multiple:!0,project:{},product:{},tableList:[],showSearch:!0,showType:"card",title:"",open:!1,select:"name",queryParams:{pageNum:1,pageSize:10,status:""},form:{},deviceQuery:{},menuQuery:{},componentPath:"iot/device/index",buttons:[{text:"详情",event:"goEdit",icon:"el-icon-info",permission:"['system:device:edit']"}],fixParams:[]}},created:function(){var e=this.$route.query.project,t=this.$route.query.product,a=this.$route.query.status,i=this.$route.query.nodeType;e&&(this.project.id=e,this.fixParams.push({key:"project",value:e})),t&&(this.product.id=t,this.fixParams.push({key:"product",value:t})),a&&(this.queryParams.status=a,this.fixParams.push({key:"status",value:a})),i&&(this.nodeType=i.split(","),this.fixParams.push({key:"nodeType",value:this.nodeType})),this.getList()},methods:{reset:function(){this.nodeType=[],this.queryParams={pageNum:1,pageSize:10,status:"",device:void 0}},onCreate:function(e){this.open=!1,this.reset(),this.select="addr",this.queryParams.device=e.addr,this.getList()},isRead:function(e){var t=this.fixParams.filter((function(t){return t.key===e}));return t.length>0},getList:function(){var e=JSON.parse(JSON.stringify(this.queryParams));delete e["device"],"addr"===this.select?e["addr[like]"]=this.queryParams.device:e["name[like]"]=this.queryParams.device,this.nodeType.length>0&&(e["nodeType"]=this.nodeType.join(",")),e["project"]=this.project.id,e["product"]=this.product.id,this.deviceQuery=e,this.menuQuery=e,this.componentPath="iot/device/index"},selectProductDone:function(e){this.product=e||{}},selectProjectDone:function(e){this.project=e||{}},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.queryParams={pageNum:1,pageSize:10,status:""},this.dateRange=[],this.handleQuery()},handleSelectionChange:function(e){var t=e.selection;this.ids=t.map((function(e){return e.id})),this.single=1!==t.length,this.multiple=!t.length,this.tableList=e.tableList,this.menuQuery={id:this.ids.join(",")},this.componentPath="iot/device/edit"},handleKick:function(){var e=this,t=this.tableList.filter((function(t){return t.id===e.ids[0]}));Object(l["d"])({addr:t[0].addr}).then((function(t){e.$modal.msgSuccess("操作成功")})).catch((function(e){console.log(e)}))},handleAdd:function(){this.open=!0},handleEvent:function(e,t){if("goEdit"===e){var a=this.$route.params.project;a?this.$router.push({path:"/"+a+"/device/deviceEdit",query:{id:t.id}}):this.$router.push({path:"/device/deviceEdit",query:{id:t.id}})}},handleDelete:function(e){var t=this,a=e.id||this.ids,i=this.table;this.$modal.confirm("是否确认删除"+this.desc+'ID为"'+a+'"的数据项？').then((function(){return Object(o["b"])(i,a)})).then((function(){t.getList(),t.$modal.msgSuccess("删除成功")})).catch((function(){}))},handleExport:function(){this.download("system/export/"+this.table,Object(n["a"])({},this.queryParams),this.desc+"_".concat((new Date).getTime(),".xlsx"))}}},p=u,h=a("2877"),m=Object(h["a"])(p,i,s,!1,null,"448514e0",null);t["default"]=m.exports}}]);