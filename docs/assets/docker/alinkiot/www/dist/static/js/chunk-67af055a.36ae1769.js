(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-67af055a","chunk-2f13dcf2","chunk-0fcaf5f4"],{"025a":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.device?t._e():i("el-card",{staticStyle:{"margin-bottom":"10px","border-width":"0px"},attrs:{shadow:"never"}},[i("el-steps",{attrs:{active:2,"align-center":"","finish-status":"success"}},[i("el-step",{attrs:{title:"步骤1",description:"创建产品、定义物模型"}}),i("el-step",{attrs:{title:"步骤2",description:"创建设备，关联产品"}}),i("el-step",{attrs:{title:"步骤3",description:"连接上云、查看实时数据"}})],1)],1),i("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[i("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"设备地址：",prop:"addr"}},[i("el-input",{attrs:{placeholder:"请输入设备地址"},model:{value:t.form.addr,callback:function(e){t.$set(t.form,"addr",e)},expression:"form.addr"}})],1),i("el-form-item",{attrs:{label:"设备名称：",prop:"name"}},[i("el-input",{attrs:{placeholder:"请输入设备名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),i("InputTableSelect",{attrs:{queryId:t.form.product,showColumn:"name",label:"所属产品 ",table:"product",prop:"product"},on:{selectDone:t.selectProductDone}}),i("br"),i("InputTableSelect",{attrs:{queryId:t.form.project,showColumn:"title",label:"所属项目",table:"project",prop:"project"},on:{selectDone:t.selectProjectDone}}),i("el-form-item",{attrs:{label:"安装位置：",prop:"location"}},[i("MapSelector",{attrs:{location:t.form.location,lat:t.form.lat,lng:t.form.lng},on:{selectDone:t.selectMapDone}})],1),i("el-form-item",{attrs:{label:"禁用状态：",prop:"status"}},[i("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.dict.type.sys_normal_disable,(function(e){return i("el-radio",{key:e.value,attrs:{label:e.value}},[t._v(t._s(e.label)+" ")])})),1)],1),i("el-form-item",[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.submitForm}},[t._v("保存")])],1)],1)],1)],1)},a=[],n=(i("b0c0"),i("84de")),l=i("19c8"),r=i("5a98"),c=i("a6e8"),s={components:{InputTableSelect:n["a"],MapSelector:l["a"]},dicts:["sys_normal_disable"],props:{device:{type:Object,default:function(){}}},data:function(){return{loading:!1,table:"device",form:{status:"0"},product:void 0,project:void 0,rules:{addr:[{required:!0,validator:c["h"],message:"设备地址只能为0-9、a-z、A-Z",trigger:"blur"}],name:[{required:!0,message:"设备名称不能为空",trigger:"blur"}],nodeType:[{required:!0,message:"设备类型不能为空",trigger:"blur"}],product:[{self:this,validator:c["j"],required:!0,message:"所属产品不能为空",trigger:"blur"}]}}},created:function(){this.device&&(this.form={id:this.device.id,addr:this.device.addr,name:this.device.name,product:this.device.product,project:this.device.project,location:this.device.location,lat:this.device.lat,lng:this.device.lng,status:this.device.status})},methods:{reset:function(){this.product=void 0,this.project=void 0,this.form={status:"0"}},submitForm:function(){var t=this;this.$refs["form"].validate((function(e){e&&(t.loading=!0,t.device?Object(r["l"])(t.table,t.form).then((function(e){t.$modal.msgSuccess("修改成功!"),t.loading=!1,t.$emit("onUpdate",t.form)})):Object(r["a"])(t.table,t.form).then((function(e){t.$modal.msgSuccess("新增成功!"),t.loading=!1,t.$emit("onCreate",t.form),t.reset()})))}))},selectMapDone:function(t){this.form.location=t.location,this.form.country=t.country,this.form.province=t.province,this.form.district=t.district,this.form.lat=t.lat,this.form.lng=t.lng},selectProjectDone:function(t){this.project=t,t?this.form.project=this.project.id:(this.form.project=void 0,this.device.project=void 0)},selectProductDone:function(t){this.product=t,t?this.form.product=this.product.id:(this.form.product=void 0,this.device.product=void 0)}}},d=s,u=i("2877"),p=Object(u["a"])(d,o,a,!1,null,"022e5996",null);e["default"]=p.exports},"19c8":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("span",[t.readonly?t.isEmpty?i("el-tag",{attrs:{type:"info"}},[t._v("未设置")]):i("p",[t._v(" "+t._s(t.location)+" "),i("el-button",{attrs:{type:"text"},on:{click:t.handleSelect}},[i("i",{staticClass:"el-icon-position el-icon--right"})])],1):i("p",[t.isEmpty?[t._v("设置")]:[t._v(t._s(t.data.location))],i("el-button",{attrs:{type:"text"},on:{click:t.handleSelect}},[i("i",{staticClass:"el-icon-edit el-icon--right"})])],2),i("el-dialog",{staticClass:"mapDialog",attrs:{title:t.readonly?"查看位置":"选择位置",visible:t.openSelector,"append-to-body":""},on:{"update:visible":function(e){t.openSelector=e}}},[t.readonly?""!==t.data.location?i("div",[i("h3",[i("i",{staticClass:"el-icon-position"}),t._v(t._s(t.data.location))])]):i("h3",[t._v("未设置")]):i("el-input",{attrs:{placeholder:"请输入设备位置"},model:{value:t.data.location,callback:function(e){t.$set(t.data,"location",e)},expression:"data.location"}},[i("el-button",{attrs:{slot:"append",type:"primary"},on:{click:t.selectDone},slot:"append"},[t._v("确定")])],1),i("div",{staticStyle:{margin:"10px 0px 10px 0px"}},[i("el-tag",[t._v("纬度:"+t._s(t.data.lat))]),i("el-tag",{staticStyle:{"margin-left":"10px"}},[t._v("经度:"+t._s(t.data.lng))])],1),i("div",{staticClass:"amap-wrapper"},[t.readonly?t._e():i("el-amap-search-box",{staticClass:"amap-search-box",attrs:{"search-option":t.searchOption,"on-search-result":t.onSearchResult}}),i("el-amap",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{vid:"amapDev",zoom:t.zoom,"map-style":t.styleName,center:t.center,plugin:t.plugins,"amap-manager":t.amapManager,events:t.events}})],1)],1)],1)},a=[],n=(i("a9e3"),i("ac1f"),i("00b4"),i("b0c0"),i("8f9b")),l=i("870c"),r=new n["AMapManager"],c={components:{},props:{name:{type:String,default:void 0},location:{type:String,default:void 0},lat:{type:Number,default:void 0},lng:{type:Number,default:void 0},readonly:{type:Boolean,default:!1}},computed:{styleName:function(){var t=this.$store.state.settings.sideTheme;return/theme-dark-.+/.test(t)?"amap://styles/blue":"amap://styles/normal"}},data:function(){var t=this;return{loading:!1,title:"",data:{location:void 0,lat:void 0,lng:void 0},isEmpty:!0,amapManager:r,plugins:["ToolBar","Autocomplete","OverView","Geocoder"],zoom:15,center:[121.59996,31.197646],openSelector:!1,searchOption:{city:"",citylimit:!1},events:{complete:function(e){t.data.lat&&t.data.lng&&t.setMarker(t.data)},click:function(e){t.loading=!0,t.data.lat=e.lnglat.lat,t.data.lng=e.lnglat.lng,t.setMarker(e.lnglat);var i=new AMap.Geocoder({});i.getAddress(e.lnglat,(function(e,i){t.loading=!1,"complete"===e&&i.regeocode&&(t.data.country=i.regeocode.addressComponent.country,t.data.province=i.regeocode.addressComponent.province,t.data.district=i.regeocode.addressComponent.district,t.data.location=i.regeocode.formattedAddress,t.setEmpty())}))}}}},created:function(){this.data={location:this.location,lng:this.lng,lat:this.lat},this.setEmpty(),Object(l["e"])(this)},methods:{setEmpty:function(){this.isEmpty=void 0===this.data.location||""===this.data.location},setMarker:function(t){t.Q=t.lat,t.R=t.lng;var e=r.getMap();this.marker&&(e.remove(this.marker),e.setFitView()),this.marker=new AMap.Marker({map:e}),this.center=[t.lng,t.lat],this.marker.setPosition(t)},selectDone:function(){var t=this.data;t.name=this.name,this.$emit("selectDone",t),this.openSelector=!1},handleSelect:function(){this.openSelector=!0},onSearchResult:function(t){if(t.length>0){var e=t[0];this.center=[e.lng,e.lat],this.data.location=e.address,this.data.lat=e.lat,this.data.lng=e.lng}}},watch:{readonly:function(){this.title=this.readonly?"查看位置":"选择位置"},location:function(){this.data={location:this.location,lat:this.lat?this.lat:"-",lng:this.lng?this.lng:"-"},this.setEmpty()}}},s=c,d=(i("2bab"),i("2877")),u=Object(d["a"])(s,o,a,!1,null,"2eae3cf5",null);e["a"]=u.exports},"2bab":function(t,e,i){"use strict";i("c0e8")},"34cf":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[t.buttons.length>0||t.title?i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t.title?i("span",{staticStyle:{"font-weight":"bold","line-height":"40px"}},[t._v(t._s(t.title))]):t._e(),i("el-button-group",{staticStyle:{float:"right",padding:"3px 0"}},t._l(t.buttons,(function(e){return i("el-button",{key:e.key,class:e.icon,staticStyle:{"margin-right":"5px"},attrs:{type:"text"},on:{click:function(i){return t.doClick(e)}}},[t._v(t._s(e.title))])})),1)],1):t._e(),t.columns.length>0?i("el-row",{staticClass:"tab-body"},t._l(t.columns,(function(e){return i("el-col",{key:e.key,staticClass:"tab-col",attrs:{xs:24,sm:12,md:8,lg:8,xl:6}},[i("div",{staticClass:"td-title"},[t._v(t._s(e.title))]),i("div",{staticClass:"td-value"},["map"===e.type?[i("MapSelector",{attrs:{name:e.key,location:t.getValue(e),lat:t.getLngLat("lat",e),lng:t.getLngLat("lng",e)},on:{selectDone:t.selectMapDone}})]:"dict"===e.type?[i("dict-tag",{attrs:{options:e.options,value:t.getValue(e)}})]:t.checkEmpty(e)?[t._v("--")]:["href"===e.type?[i("el-link",{attrs:{type:"primary","underline:":"true",href:t.getValue(e),target:"_blank"}},[t._v("访问")])]:"image"===e.type?[i("ImagePreview",{staticStyle:{width:"20px"},attrs:{src:t.getValue(e)}})]:"secret"===e.type?[i("span",{staticClass:"secret-box"},[t._v("******")]),i("el-popover",{attrs:{placement:"bottom",title:e.title+":",width:"200",trigger:"click",content:t.getValue(e)}},[i("el-button",{attrs:{slot:"reference",type:"text",icon:"el-icon-view"},slot:"reference"})],1)]:[t._v(" "+t._s(t.getValue(e))+" ")]],e.click?i("el-button",{attrs:{type:"text",icon:e.click.icon,circle:""},on:{click:function(i){return t.doClick(e)}}},[e.click.title?[t._v(" "+t._s(e.click.title)+" ")]:t._e()],2):t._e()],2)])})),1):i("el-empty",{attrs:{description:"暂无"+t.title}})],1)},a=[],n=(i("b0c0"),i("4de4"),i("d3b7"),i("a15b"),i("5a0c")),l=i.n(n),r=i("9a2d"),c=i("19c8"),s={components:{MapSelector:c["a"],ImagePreview:r["a"]},props:{title:{type:String,default:void 0},columns:{type:Array,default:function(){return[]}},item:{type:Object,default:function(){return{}}},buttons:{type:Array,default:function(){return[]}}},data:function(){return{}},created:function(){},methods:{checkEmpty:function(t){var e=this.getValue(t);return null===e||void 0===e||""===e},doClick:function(t){this.$emit("click",t)},selectMapDone:function(t){var e=t.name,i=this.columns.filter((function(t){return t.key===e}));if(i.length>0){var o=i[0];this.$emit("selectMapDone",o,t)}},getLngLat:function(t,e){var i=e[t];return this.item[i]},getValue:function(t){var e=t.key,i=t.format,o=this.item[e];if("relation"===t.type){var a=t.on,n=this.item[a];return i?i(e,{field:n,key:o}):n||o?(n=n||"--",o=o||"--",[o,n].join(",")):void 0}return"datetime"===t.type?o?l()(1e3*o).format("YYYY-MM-DD HH:mm:ss"):void 0:i?i(e,o):o}}},d=s,u=(i("d8ff"),i("2877")),p=Object(u["a"])(d,o,a,!1,null,"111fd298",null);e["a"]=p.exports},"452d":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("TableShow",{attrs:{title:"扩展字段",columns:t.columns,item:t.extend,buttons:t.buttons},on:{click:t.itemClick}}),i("el-dialog",{attrs:{title:"扩展字段",visible:t.open},on:{"update:visible":function(e){t.open=e}}},[i("el-form",{ref:"cfgForm",attrs:{rules:t.cfgFormRule,model:t.form,"label-position":"top",prop:"cfgForm"}},[i("el-form-item",{attrs:{label:"字段名称",prop:"title"}},[i("el-input",{attrs:{placeholder:"请输入字段名称"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),t.isCreate?[i("el-form-item",{attrs:{label:"字段标识",prop:"name"}},[i("el-input",{attrs:{placeholder:"请输入字段标识"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),i("el-form-item",{attrs:{label:"数据类型",prop:"type"}},[i("el-select",{attrs:{placeholder:"数据类型"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type","string"===typeof e?e.trim():e)},expression:"form.type"}},t._l(t.dict.type.iot_data_type,(function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)]:t._e(),i("el-form-item",{attrs:{label:"数据值",prop:"value"}},["integer"===t.form.type?i("el-input",{attrs:{placeholder:"请输入数值"},model:{value:t.form.value,callback:function(e){t.$set(t.form,"value",t._n(e))},expression:"form.value"}}):i("el-input",{attrs:{placeholder:"请输入数据内容"},model:{value:t.form.value,callback:function(e){t.$set(t.form,"value",e)},expression:"form.value"}})],1),i("el-form-item",[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.addExtendDone}},[t._v("确定")]),t.isCreate?t._e():i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:t.delExtend}},[t._v("删除")])],1)],2)],1)],1)},a=[],n=(i("a9e3"),i("d81d"),i("b0c0"),i("4de4"),i("d3b7"),i("b64b"),i("e9c4"),i("5a98")),l=i("34cf"),r={dicts:["iot_data_type"],components:{TableShow:l["a"]},props:{id:{type:[Number,String],required:!0},table:{type:String}},data:function(){return{open:!1,form:{},extendTable:[],isCreate:!0,columns:[],extend:{},buttons:[{icon:"el-icon-plus",key:"addExtend",title:"新增"},{icon:"el-icon-delete",key:"cleanAll",title:"清空"}],cfgFormRule:{type:[{required:!0,message:"数据类型不能为空",trigger:"blur"}],name:[{required:!0,message:"字段标识不能为空",trigger:"blur"}],title:[{required:!0,message:"字段名称不能为空",trigger:"blur"}]}}},created:function(){this.getExtend()},methods:{createData:function(){var t=this;this.columns=[],this.extendTable.map((function(e){t.extend[e.name]=e.value;var i={key:e.name,title:e.title,type:"text",click:{icon:"el-icon-edit-outline"}};e.default&&(i.title=e.title),t.columns.push(i)}))},itemClick:function(t){if("addExtend"===t.key)this.isCreate=!0,this.form={},this.open=!0;else if("cleanAll"===t.key)this.delAll();else{this.isCreate=!1;var e=this.extendTable.filter((function(e){return e.name===t.key}));e.length>0&&(this.form=e[0],this.open=!0)}},getExtend:function(t){var e=this;Object(n["g"])(this.table,this.id).then((function(i){var o=i.data,a=o.config?JSON.parse(o.config):[];"device"===e.table&&o.product?Object(n["g"])("product",o.product).then((function(i){var o=i.data.config?JSON.parse(i.data.config):[];o.map((function(t){var e=a.filter((function(e){return e.name===t.name}));0===e.length&&(t.default=!0,a.push(t))})),e.extendTable=a,e.createData(),t&&t()})):(e.extendTable=a,e.createData(),t&&t())}))},delAll:function(){var t=this,e={id:this.id,config:JSON.stringify([])},i=this;Object(n["l"])(this.table,e).then((function(e){t.getExtend((function(){i.open=!1}))}))},delExtend:function(){var t=this,e=this.form.name,i=this.extendTable.filter((function(t){return!t.default&&t.name!==e})),o={id:this.id,config:JSON.stringify(i)},a=this;Object(n["l"])(this.table,o).then((function(e){t.getExtend((function(){a.open=!1}))}))},addExtendDone:function(){var t=this;this.$refs["cfgForm"].validate((function(e){if(e){var i=t.form.value;"float"===t.form.type&&(i=parseFloat(i));var o={title:t.form.title,name:t.form.name,type:t.form.type,value:i},a=[],l=!0;t.extendTable.map((function(e){e.name===t.form.name?(l=!1,a.push(o)):a.push(e)})),l&&a.push(o);var r={id:t.id,config:JSON.stringify(a)};Object(n["l"])(t.table,r).then((function(e){t.open=!1,t.extendTable=a,t.createData(),t.$modal.msgSuccess(l?"创建成功!":"更新成功!")}))}}))}}},c=r,s=i("2877"),d=Object(s["a"])(c,o,a,!1,null,"75e6d1de",null);e["default"]=d.exports},"8f18":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[t.device?i("el-row",[i("el-col",{attrs:{span:t.product&&t.product.img?18:24}},[i("TableShow",{attrs:{title:"基本信息",columns:t.device_columns,item:t.device,buttons:t.buttons},on:{click:t.onClick}}),t.product?i("TableShow",{attrs:{title:"产品信息",columns:t.product_columns,item:t.product},on:{click:t.onProductClick}}):t._e(),i("ExtendEditor",{attrs:{table:"device",id:t.id}})],1),t.product&&t.product.img?i("el-col",{staticStyle:{"text-align":"center"},attrs:{span:6}},[i("ImagePreview",{staticStyle:{width:"80%"},attrs:{src:t.product.img}})],1):t._e()],1):i("el-empty",{attrs:{description:"找不到该设备"}}),i("el-drawer",{attrs:{title:"编辑设备",visible:t.openEditDialog,direction:"rtl",size:"40%"},on:{"update:visible":function(e){t.openEditDialog=e}}},[i("DeviceForm",{staticStyle:{padding:"10px"},attrs:{device:t.device},on:{onUpdate:t.onUpdate}})],1),i("el-dialog",{attrs:{title:"设置设备密钥",visible:t.openSecretSelector},on:{"update:visible":function(e){t.openSecretSelector=e}}},[i("el-form",{ref:"keyForm",attrs:{"status-icon":"",rules:t.keyFormRule,model:t.secret,"label-width":"80px",prop:"keyForm"}},[i("el-form-item",{attrs:{label:"设备Key",prop:"key"}},[i("el-input",{attrs:{placeholder:"请输入设备Key"},model:{value:t.secret.key,callback:function(e){t.$set(t.secret,"key",e)},expression:"secret.key"}},[i("el-button",{attrs:{slot:"append",type:"text",icon:"el-icon-refresh",circle:""},on:{click:t.createKey},slot:"append"})],1)],1),i("el-form-item",{attrs:{label:"设备密钥",prop:"secret"}},[i("el-input",{attrs:{placeholder:"请输入设备密钥"},model:{value:t.secret.value,callback:function(e){t.$set(t.secret,"value",e)},expression:"secret.value"}},[i("el-button",{attrs:{slot:"append",type:"text",icon:"el-icon-refresh",circle:""},on:{click:t.createSecret},slot:"append"})],1)],1),i("el-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{title:"警告:更新密钥会导致旧设备无法连接!",type:"warning",closable:!1}}),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:t.addDevSecretDone}},[t._v("更新")])],1)],1)],1)],1)},a=[],n=i("c7eb"),l=i("1da1"),r=(i("a9e3"),i("34cf")),c=i("5a98"),s=i("025a"),d=i("a6e8"),u=i("452d"),p=i("870c"),m={components:{ExtendEditor:u["default"],DeviceForm:s["default"],TableShow:r["a"]},dicts:["sys_normal_disable","iot_node_type","iot_net_type","iot_device_status","iot_auto_register","iot_product_mgr","iot_protocol_id"],props:{id:{type:[String,Number],default:void 0}},data:function(){return{loading:!1,device_columns:[],product_columns:[],openSecretSelector:!1,secret:{key:"",value:""},device:void 0,product:void 0,online:void 0,openEditDialog:!1,buttons:[],keyFormRule:{key:[{required:!0,len:8,validator:d["b"],message:"只能大小写字母，数字组成的8位字符串",trigger:"blur"}],value:[{required:!0,len:16,validator:d["b"],message:"只能大小写字母，数字组成的16位字符串",trigger:"blur"}]}}},created:function(){this.device_columns=[{key:"name",title:"设备名称",type:"text"},{key:"addr",title:"设备地址",type:"text"},{key:"online",title:"在线状态",type:"dict",options:this.dict.type.iot_device_status},{key:"lastOnline",title:"上线时间",type:"datetime"},{key:"status",title:"是否禁用",type:"dict",options:this.dict.type.sys_normal_disable},{key:"dk",title:"设备Key",type:"text",click:{icon:"el-icon-refresh"}},{key:"ds",title:"设备密钥",type:"secret",click:{icon:"el-icon-refresh"}},{key:"createTime",title:"创建时间",type:"text"}],this.product_columns=[{key:"name",title:"产品名称",type:"text",click:{icon:"el-icon-link"}},{key:"autoRegister",title:"自动注册",type:"dict",options:this.dict.type.iot_auto_register},{key:"nodeType",title:"节点类型",type:"dict",options:this.dict.type.iot_node_type},{key:"netType",title:"网络类型",type:"dict",options:this.dict.type.iot_net_type},{key:"pk",title:"产品Key",type:"text"},{key:"ps",title:"产品密钥",type:"secret"},{key:"category",title:"产品分类",type:"dict",options:this.dict.type.iot_product_mgr},{key:"protocol",title:"协议标识",type:"dict",options:this.dict.type.iot_protocol_id},{key:"status",title:"是否停用",type:"dict",options:this.dict.type.sys_normal_disable},{key:"doc",title:"帮助文档",type:"href"}],this.load()},methods:{onClick:function(t){"kickDevice"===t.key?this.handleKick(this.device):"editDevice"===t.key?this.openEditDialog=!0:"ds"!==t.key&&"dk"!==t.key||(this.secret={key:this.device.dk,value:this.device.ds},this.openSecretSelector=!0)},onProductClick:function(t){"name"===t.key&&this.$router.push({path:"/device/productEdit",query:{id:this.product.id}})},handleKick:function(t){var e=this;Object(p["d"])({addr:t.addr}).then((function(t){e.getDeviceStatus(),e.$modal.msgSuccess("操作成功")})).catch((function(t){console.log(t)}))},createSecret:function(){this.secret.value=Object(d["e"])(16)},createKey:function(){this.secret.key=Object(d["e"])(8)},getDeviceStatus:function(){var t=this;return Object(l["a"])(Object(n["a"])().mark((function e(){var i,o;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["j"])(t.device.addr);case 2:i=e.sent,o=i.data,o[0]?(t.device.online=o[0].online,t.device.lastOnline=o[0].connectTime):(t.device.online=!1,t.device.lastOnline=void 0),t.buttons=[{icon:"el-icon-edit-outline",key:"editDevice",title:"编辑"}],t.device.online&&t.buttons.push({icon:"el-icon-close",key:"kickDevice",title:"下线"}),t.$emit("onload",{device:t.device,product:t.product});case 8:case"end":return e.stop()}}),e)})))()},load:function(){var t=this;this.loading=!0,Object(c["g"])("device",this.id).then((function(e){var i=e.data;i.product&&Object(c["g"])("product",i.product).then((function(e){t.product=e.data,t.device=i,t.getDeviceStatus(),t.loading=!1}))})).catch((function(e){t.loading=!1}))},onUpdate:function(t){this.load(),this.openEditDialog=!1},addDevSecretDone:function(){var t=this;this.$refs["keyForm"].validate((function(e){if(e){var i={id:t.device.id,dk:t.secret.key,ds:t.secret.value};Object(c["l"])("device",i).then((function(e){200===e.code?(t.device.dk=t.secret.key,t.device.ds=t.secret.value,t.$modal.msgSuccess("保存成功！"),t.openSecretSelector=!1):t.$modal.msgError("保存失败！")}))}}))}}},f=m,h=i("2877"),v=Object(h["a"])(f,o,a,!1,null,"6401b809",null);e["default"]=v.exports},"9b59":function(t,e,i){},c0e8:function(t,e,i){},d8ff:function(t,e,i){"use strict";i("9b59")}}]);