{"./":{"url":"./","title":"介绍","keywords":"","body":"MQTT Broker 介绍 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 17:07:09 "},"quick_start.html":{"url":"quick_start.html","title":"快速开始","keywords":"","body":"快速开始 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 03:39:04 "},"deployment/installation.html":{"url":"deployment/installation.html","title":"安装部署","keywords":"","body":"安装部署 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 03:39:45 "},"deployment/docker_deployment.html":{"url":"deployment/docker_deployment.html","title":"Docker 部署","keywords":"","body":"Docker 部署 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 03:40:31 "},"deployment/kubernetes_deployment.html":{"url":"deployment/kubernetes_deployment.html","title":"Kubernetes 部署","keywords":"","body":"Kubernetes 部署 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 03:40:59 "},"deployment/binary_deployment.html":{"url":"deployment/binary_deployment.html","title":"二进制部署","keywords":"","body":"二进制部署 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 03:41:35 "},"deployment/source_compile.html":{"url":"deployment/source_compile.html","title":"源码编译","keywords":"","body":"编译编译 MQTT Broker Build make shell uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-22 06:03:36 "},"config/":{"url":"config/","title":"配置","keywords":"","body":"配置说明 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 06:15:35 "},"config/mqtt.html":{"url":"config/mqtt.html","title":"MQTT 配置","keywords":"","body":"MQTT 配置 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-22 05:32:24 "},"config/filter.html":{"url":"config/filter.html","title":"过滤器配置","keywords":"","body":"过滤器配置 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-22 05:30:37 "},"api/":{"url":"api/","title":"用户指南","keywords":"","body":"API 文档说明 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-22 05:54:35 "},"plugin/":{"url":"plugin/","title":"插件","keywords":"","body":"插件说明 HTTP 鉴权 Redis 鉴权 Kafka 消息推送 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-22 05:57:02 "},"plugin/auth_http.html":{"url":"plugin/auth_http.html","title":"HTTP 鉴权","keywords":"","body":"http 鉴权插件 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 06:15:47 "},"plugin/auth_redis.html":{"url":"plugin/auth_redis.html","title":"Redis 鉴权","keywords":"","body":"redis 鉴权插件 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 06:15:57 "},"plugin/bridge_kafka.html":{"url":"plugin/bridge_kafka.html","title":"Kafka 消息推送","keywords":"","body":"kafka 消息推送 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 06:16:04 "},"ops/":{"url":"ops/","title":"运维手册","keywords":"","body":"运维说明 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 06:16:50 "},"ops/log.html":{"url":"ops/log.html","title":"日志查询","keywords":"","body":"日志说明 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 06:16:42 "},"ops/sop.html":{"url":"ops/sop.html","title":"故障处理","keywords":"","body":"常见故障处理 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 06:31:10 "},"metrics/":{"url":"metrics/","title":"监控告警","keywords":"","body":"监控指标 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 06:17:05 "},"metrics/mqtt.html":{"url":"metrics/mqtt.html","title":"MQTT 应用指标","keywords":"","body":"MQTT 系统监控指标 概述 本文档总结了Prometheus监控系统暴露的关键指标，按系统组件和功能分类。 1. 服务健康指标 1.1 应用实例 指标：app_instances 类型：仪表盘（Gauge） 描述：通过实例信息监控服务健康状态 标签： app：服务名称 node：主机名 zone：区域 ip：节点IP地址 1.2 活跃连接数 指标：active_connections_count 类型：仪表盘（Gauge） 描述：跟踪活跃连接数量 标签： zone：区域标识 2. MQTT指标 2.1 消息处理 指标：mqtt_messages_received_total 类型：计数器（Counter） 描述：按类型统计接收的MQTT消息数量 标签： key：消息类型（订阅/subscribe、接收发布/pub_recv、MQTT传递/mqtt_deliver） 2.2 性能延迟 指标：mqtt_acl_duration_microseconds 类型：直方图（Histogram） 描述：ACL处理延迟分布 标签： status：ACL状态 指标：mqtt_pub_duration_microseconds 类型：直方图（Histogram） 描述：消息发布延迟分布 标签： status：发布状态 指标：mqtt_auth_duration_microseconds 类型：直方图（Histogram） 描述：认证延迟分布 标签： status：认证状态 3. RPC指标 3.1 RPC性能 指标：rpc_duration_microseconds 类型：直方图（Histogram） 描述：RPC调用延迟分布 标签： node：目标节点 method：RPC方法名 status：调用状态 4. API指标 4.1 API性能 指标：api_handle_duration_microseconds 类型：直方图（Histogram） 描述：API请求处理延迟 标签： key：API端点名称 status：响应状态 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-22 01:51:28 "},"metrics/db.html":{"url":"metrics/db.html","title":"数据库指标","keywords":"","body":"数据库指标 1 Mnesia操作 指标：mnesia_handle_duration_microseconds 类型：直方图（Histogram） 描述：Mnesia操作执行时间 标签： key：操作类型 tab：表名 2 事务指标 指标： erlang_mnesia_held_locks erlang_mnesia_lock_queue erlang_mnesia_transaction_participants erlang_mnesia_transaction_coordinators erlang_mnesia_failed_transactions erlang_mnesia_committed_transactions erlang_mnesia_logged_transactions erlang_mnesia_restarted_transactions 3 内存使用情况 指标：erlang_mnesia_memory_usage_bytes 描述：Mnesia使用的总内存 指标：erlang_mnesia_tablewise_memory_usage_bytes 描述：每张表的内存使用情况 标签： table：表名 指标：erlang_mnesia_tablewise_size 描述：每张表的行数 标签： table：表名 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 02:33:07 "},"metrics/kafka.html":{"url":"metrics/kafka.html","title":"Kafka 指标","keywords":"","body":"Kafka 监控 5.1 消息处理 指标：kafka_message_duration_microseconds 类型：直方图（Histogram） 描述：Kafka消息处理时间 标签： type：消息类型 status：处理状态 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-22 05:57:04 "},"metrics/erlang_vm.html":{"url":"metrics/erlang_vm.html","title":"Erlang VM 指标","keywords":"","body":"Erlang VM 指标报告 本文档总结了Prometheus监控系统暴露的关键指标，按系统组件和功能分类。 7.1 内存管理 指标： erlang_vm_memory_atom_bytes_total erlang_vm_memory_bytes_total erlang_vm_memory_processes_bytes_total erlang_vm_memory_system_bytes_total 7.2 进程管理 指标： erlang_vm_process_count erlang_vm_process_limit erlang_vm_port_count erlang_vm_port_limit 7.3 调度器指标 指标： erlang_vm_schedulers erlang_vm_schedulers_online erlang_vm_dirty_cpu_schedulers erlang_vm_dirty_io_schedulers 7.4 垃圾回收 指标： erlang_vm_statistics_garbage_collection_number_of_gcs erlang_vm_statistics_garbage_collection_bytes_reclaimed erlang_vm_statistics_garbage_collection_words_reclaimed 7.5 系统统计信息 指标： erlang_vm_statistics_reductions_total erlang_vm_statistics_runtime_milliseconds erlang_vm_statistics_wallclock_time_milliseconds erlang_vm_statistics_bytes_output_total erlang_vm_statistics_bytes_received_total uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 02:31:23 "},"metrics/alarm.html":{"url":"metrics/alarm.html","title":"告警配置","keywords":"","body":"监控指标说明文档 1. 服务概览 1.1 服务部署情况 指标：app_instances（gauge类型） 含义：监控服务健康状态，包含实例部署信息 标签：app（服务名）、node（主机名）、zone（区域）、ip（节点IP） 当前数据：app_instances{app=\"alinkiot\",node=\"alinkiot@172.25.102.82\",zone=\"default\",ip=\"172.25.102.82\"} 1 结论：当前default区域部署了1个alinkiot服务实例，主机名为alinkiot@172.25.102.82，IP为172.25.102.82。 1.2 当前连接数 指标：active_connections_count（gauge类型） 含义：当前活跃连接数 标签：zone（区域） 当前数据：active_connections_count{zone=\"default\"} 1 结论：default区域当前活跃连接数为1。 2. MQTT性能指标 2.1 消息接收统计 指标：mqtt_messages_received_total（counter类型） 含义：按消息类型统计的MQTT消息接收总量 标签：key（消息类型） 当前数据：subscribe=1，pub_recv=9，mqtt_deliver=9 结论：pub_recv和mqtt_deliver类型消息接收量较高（各9条），subscribe类型较少（1条）。 PromQL示例：# 按消息类型统计总接收量 mqtt_messages_received_total # 近5分钟各类型消息接收速率 rate(mqtt_messages_received_total[5m]) 2.2 延迟分布指标 2.2.1 ACL处理延迟（mqtt_acl_duration_microseconds） 类型：histogram 含义：ACL（访问控制列表）处理延迟分布 标签：status（ACL状态） 当前数据：status=\"allow\"时，所有分桶计数均为1，sum=0.586微秒 结论：ACL处理延迟极低（平均约0.586微秒），且所有请求均通过（allow状态）。 PromQL示例（95分位数）：histogram_quantile(0.95, sum(rate(mqtt_acl_duration_microseconds_bucket[5m])) by (le)) 2.2.2 消息发布延迟（mqtt_pub_duration_microseconds） 类型：histogram 含义：消息发布延迟分布 标签：status（发布状态） 当前数据：status=\"success\"时，所有分桶计数均为9，sum=0.329微秒 结论：消息发布延迟稳定（平均约0.329微秒），且全部成功。 PromQL示例（平均延迟）：sum(rate(mqtt_pub_duration_microseconds_sum[5m])) by (status) / sum(rate(mqtt_pub_duration_microseconds_count[5m])) by (status) 3. RPC性能分析 指标：rpc_duration_microseconds（histogram类型） 含义：RPC请求延迟分布 标签：node（节点）、method（方法）、status（调用状态） 3.1 按方法与状态分类统计 当前数据（node=\"local\"）： method=\"subscribe\"，status=\"success\"：计数1 method=\"publish\"，status=\"unknow\"：计数9 method=\"open_session\"，status=\"success\"：计数2 3.2 异常调用识别 异常状态：status=\"unknow\"出现在publish和match_routes方法（各9次），需检查接口返回状态码是否规范。 3.3 方法成功率计算 示例（open_session方法）： (sum(rpc_duration_microseconds_count{method=\"open_session\",status=\"success\"}) / sum(rpc_duration_microseconds_count{method=\"open_session\"})) * 100 3.4 延迟百分位查询 histogram_quantile(0.90, sum(rate(rpc_duration_microseconds_bucket[5m])) by (le, method)) 4. Mnesia数据库监控 4.1 表内存使用 指标：erlang_mnesia_tablewise_memory_usage_bytes（gauge类型） 当前数据：mqtt_client=2600B，mqtt_route=10776B（最大），schema=7472B 容量建议：定期监控mqtt_route表内存增长，避免超过节点内存限制。 4.2 事务统计 指标：erlang_mnesia_committed_transactions（counter类型，当前值3），erlang_mnesia_failed_transactions（counter类型，当前值4） 结论：失败事务（4次）多于成功事务（3次），需排查事务回滚原因。 4.3 锁竞争 指标：erlang_mnesia_held_locks=0，erlang_mnesia_lock_queue=0 结论：当前无锁竞争，事务执行流畅。 5. 综合PromQL示例 服务健康状态概览：app_instances + active_connections_count 消息处理吞吐量趋势：rate(mqtt_messages_received_total[1m]) 异常请求追踪：rpc_duration_microseconds_count{status=\"unknow\"} 资源使用TOP N（Mnesia表内存）：topk(3, erlang_mnesia_tablewise_memory_usage_bytes) 历史性能对比（近7天同时间段RPC延迟）：histogram_quantile(0.95, sum(rate(rpc_duration_microseconds_bucket[1h])) by (le)) offset 7d uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-22 06:02:05 "},"solution.html":{"url":"solution.html","title":"最佳实践","keywords":"","body":"解决方案 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 06:15:02 "},"FAQ.html":{"url":"FAQ.html","title":"常见问题","keywords":"","body":"常见问题 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 06:15:26 "},"test.html":{"url":"test.html","title":"测试报告","keywords":"","body":"测试用例 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 06:15:12 "},"links.html":{"url":"links.html","title":"相关链接","keywords":"","body":"相关链接 MQTT 协议 uzyiot team all right reserved，powered by Gitbook最后修改时间： 2025-05-21 06:12:22 "}}